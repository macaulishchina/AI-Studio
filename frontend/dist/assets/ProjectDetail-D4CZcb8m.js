var vs=Object.defineProperty;var xn=a=>{throw TypeError(a)};var ks=(a,n,e)=>n in a?vs(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e;var ue=(a,n,e)=>ks(a,typeof n!="symbol"?n+"":n,e),xs=(a,n,e)=>n.has(a)||xn("Cannot "+e);var bn=(a,n,e)=>n.has(a)?xn("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(a):n.set(a,e);var Ct=(a,n,e)=>(xs(a,n,"access private method"),e);import{z as Xt,x as Ze,p as Ye,n as G,r as U,A as At,B as Dn,d as rt,C as nn,o as ut,D as sn,g as u,c as x,a as h,b as p,w as i,t as C,i as A,h as k,m as d,j as Q,F as ae,v as he,E as bs,G as wn,y as Re,q as at,e as B,k as Cn,f as ws}from"./index-okdrDDuw.js";import{u as Cs}from"./project-CrB2xI0u.js";import{m as Wt,p as vt,d as we,t as Yt,i as it,a as Qt,s as Vt}from"./index-Bz-GYz9Z.js";import{useAuthStore as ln}from"./auth-Y0P-C008.js";import{u as Rt,g as Gt}from"./providerIcons-BEGbTQUu.js";import{_ as zs}from"./_plugin-vue_export-helper-DlAUqK2U.js";function on(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let nt=on();function En(a){nt=a}const qn=/[&<>"']/,Ts=new RegExp(qn.source,"g"),Bn=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,$s=new RegExp(Bn.source,"g"),Ss={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},zn=a=>Ss[a];function Se(a,n){if(n){if(qn.test(a))return a.replace(Ts,zn)}else if(Bn.test(a))return a.replace($s,zn);return a}const Is=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Ms(a){return a.replace(Is,(n,e)=>(e=e.toLowerCase(),e==="colon"?":":e.charAt(0)==="#"?e.charAt(1)==="x"?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""))}const js=/(^|[^\[])\^/g;function se(a,n){let e=typeof a=="string"?a:a.source;n=n||"";const t={replace:(o,s)=>{let l=typeof s=="string"?s:s.source;return l=l.replace(js,"$1"),e=e.replace(o,l),t},getRegex:()=>new RegExp(e,n)};return t}function Tn(a){try{a=encodeURI(a).replace(/%25/g,"%")}catch{return null}return a}const _t={exec:()=>null};function $n(a,n){const e=a.replace(/\|/g,(s,l,c)=>{let m=!1,T=l;for(;--T>=0&&c[T]==="\\";)m=!m;return m?"|":" |"}),t=e.split(/ \|/);let o=0;if(t[0].trim()||t.shift(),t.length>0&&!t[t.length-1].trim()&&t.pop(),n)if(t.length>n)t.splice(n);else for(;t.length<n;)t.push("");for(;o<t.length;o++)t[o]=t[o].trim().replace(/\\\|/g,"|");return t}function zt(a,n,e){const t=a.length;if(t===0)return"";let o=0;for(;o<t&&a.charAt(t-o-1)===n;)o++;return a.slice(0,t-o)}function As(a,n){if(a.indexOf(n[1])===-1)return-1;let e=0;for(let t=0;t<a.length;t++)if(a[t]==="\\")t++;else if(a[t]===n[0])e++;else if(a[t]===n[1]&&(e--,e<0))return t;return-1}function Sn(a,n,e,t){const o=n.href,s=n.title?Se(n.title):null,l=a[1].replace(/\\([\[\]])/g,"$1");if(a[0].charAt(0)!=="!"){t.state.inLink=!0;const c={type:"link",raw:e,href:o,title:s,text:l,tokens:t.inlineTokens(l)};return t.state.inLink=!1,c}return{type:"image",raw:e,href:o,title:s,text:Se(l)}}function Rs(a,n){const e=a.match(/^(\s+)(?:```)/);if(e===null)return n;const t=e[1];return n.split(`
`).map(o=>{const s=o.match(/^\s+/);if(s===null)return o;const[l]=s;return l.length>=t.length?o.slice(t.length):o}).join(`
`)}class St{constructor(n){ue(this,"options");ue(this,"rules");ue(this,"lexer");this.options=n||nt}space(n){const e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(n){const e=this.rules.block.code.exec(n);if(e){const t=e[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:zt(t,`
`)}}}fences(n){const e=this.rules.block.fences.exec(n);if(e){const t=e[0],o=Rs(t,e[3]||"");return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:o}}}heading(n){const e=this.rules.block.heading.exec(n);if(e){let t=e[2].trim();if(/#$/.test(t)){const o=zt(t,"#");(this.options.pedantic||!o||/ $/.test(o))&&(t=o.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(n){const e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:e[0]}}blockquote(n){const e=this.rules.block.blockquote.exec(n);if(e){let t=e[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);t=zt(t.replace(/^ *>[ \t]?/gm,""),`
`);const o=this.lexer.state.top;this.lexer.state.top=!0;const s=this.lexer.blockTokens(t);return this.lexer.state.top=o,{type:"blockquote",raw:e[0],tokens:s,text:t}}}list(n){let e=this.rules.block.list.exec(n);if(e){let t=e[1].trim();const o=t.length>1,s={type:"list",raw:"",ordered:o,start:o?+t.slice(0,-1):"",loose:!1,items:[]};t=o?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=o?t:"[*+-]");const l=new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`);let c="",m="",T=!1;for(;n;){let _=!1;if(!(e=l.exec(n))||this.rules.block.hr.test(n))break;c=e[0],n=n.substring(c.length);let f=e[2].split(`
`,1)[0].replace(/^\t+/,D=>" ".repeat(3*D.length)),v=n.split(`
`,1)[0],S=0;this.options.pedantic?(S=2,m=f.trimStart()):(S=e[2].search(/[^ ]/),S=S>4?1:S,m=f.slice(S),S+=e[1].length);let w=!1;if(!f&&/^ *$/.test(v)&&(c+=v+`
`,n=n.substring(v.length+1),_=!0),!_){const D=new RegExp(`^ {0,${Math.min(3,S-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),E=new RegExp(`^ {0,${Math.min(3,S-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),y=new RegExp(`^ {0,${Math.min(3,S-1)}}(?:\`\`\`|~~~)`),H=new RegExp(`^ {0,${Math.min(3,S-1)}}#`);for(;n;){const M=n.split(`
`,1)[0];if(v=M,this.options.pedantic&&(v=v.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),y.test(v)||H.test(v)||D.test(v)||E.test(n))break;if(v.search(/[^ ]/)>=S||!v.trim())m+=`
`+v.slice(S);else{if(w||f.search(/[^ ]/)>=4||y.test(f)||H.test(f)||E.test(f))break;m+=`
`+v}!w&&!v.trim()&&(w=!0),c+=M+`
`,n=n.substring(M.length+1),f=v.slice(S)}}s.loose||(T?s.loose=!0:/\n *\n *$/.test(c)&&(T=!0));let I=null,F;this.options.gfm&&(I=/^\[[ xX]\] /.exec(m),I&&(F=I[0]!=="[ ] ",m=m.replace(/^\[[ xX]\] +/,""))),s.items.push({type:"list_item",raw:c,task:!!I,checked:F,loose:!1,text:m,tokens:[]}),s.raw+=c}s.items[s.items.length-1].raw=c.trimEnd(),s.items[s.items.length-1].text=m.trimEnd(),s.raw=s.raw.trimEnd();for(let _=0;_<s.items.length;_++)if(this.lexer.state.top=!1,s.items[_].tokens=this.lexer.blockTokens(s.items[_].text,[]),!s.loose){const f=s.items[_].tokens.filter(S=>S.type==="space"),v=f.length>0&&f.some(S=>/\n.*\n/.test(S.raw));s.loose=v}if(s.loose)for(let _=0;_<s.items.length;_++)s.items[_].loose=!0;return s}}html(n){const e=this.rules.block.html.exec(n);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(n){const e=this.rules.block.def.exec(n);if(e){const t=e[1].toLowerCase().replace(/\s+/g," "),o=e[2]?e[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:o,title:s}}}table(n){const e=this.rules.block.table.exec(n);if(!e||!/[:|]/.test(e[2]))return;const t=$n(e[1]),o=e[2].replace(/^\||\| *$/g,"").split("|"),s=e[3]&&e[3].trim()?e[3].replace(/\n[ \t]*$/,"").split(`
`):[],l={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===o.length){for(const c of o)/^ *-+: *$/.test(c)?l.align.push("right"):/^ *:-+: *$/.test(c)?l.align.push("center"):/^ *:-+ *$/.test(c)?l.align.push("left"):l.align.push(null);for(const c of t)l.header.push({text:c,tokens:this.lexer.inline(c)});for(const c of s)l.rows.push($n(c,l.header.length).map(m=>({text:m,tokens:this.lexer.inline(m)})));return l}}lheading(n){const e=this.rules.block.lheading.exec(n);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(n){const e=this.rules.block.paragraph.exec(n);if(e){const t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(n){const e=this.rules.block.text.exec(n);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(n){const e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:Se(e[1])}}tag(n){const e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&/^<a /i.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(n){const e=this.rules.inline.link.exec(n);if(e){const t=e[2].trim();if(!this.options.pedantic&&/^</.test(t)){if(!/>$/.test(t))return;const l=zt(t.slice(0,-1),"\\");if((t.length-l.length)%2===0)return}else{const l=As(e[2],"()");if(l>-1){const m=(e[0].indexOf("!")===0?5:4)+e[1].length+l;e[2]=e[2].substring(0,l),e[0]=e[0].substring(0,m).trim(),e[3]=""}}let o=e[2],s="";if(this.options.pedantic){const l=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(o);l&&(o=l[1],s=l[3])}else s=e[3]?e[3].slice(1,-1):"";return o=o.trim(),/^</.test(o)&&(this.options.pedantic&&!/>$/.test(t)?o=o.slice(1):o=o.slice(1,-1)),Sn(e,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer)}}reflink(n,e){let t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){const o=(t[2]||t[1]).replace(/\s+/g," "),s=e[o.toLowerCase()];if(!s){const l=t[0].charAt(0);return{type:"text",raw:l,text:l}}return Sn(t,s,t[0],this.lexer)}}emStrong(n,e,t=""){let o=this.rules.inline.emStrongLDelim.exec(n);if(!o||o[3]&&t.match(/[\p{L}\p{N}]/u))return;if(!(o[1]||o[2]||"")||!t||this.rules.inline.punctuation.exec(t)){const l=[...o[0]].length-1;let c,m,T=l,_=0;const f=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,e=e.slice(-1*n.length+l);(o=f.exec(e))!=null;){if(c=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!c)continue;if(m=[...c].length,o[3]||o[4]){T+=m;continue}else if((o[5]||o[6])&&l%3&&!((l+m)%3)){_+=m;continue}if(T-=m,T>0)continue;m=Math.min(m,m+T+_);const v=[...o[0]][0].length,S=n.slice(0,l+o.index+v+m);if(Math.min(l,m)%2){const I=S.slice(1,-1);return{type:"em",raw:S,text:I,tokens:this.lexer.inlineTokens(I)}}const w=S.slice(2,-2);return{type:"strong",raw:S,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(n){const e=this.rules.inline.code.exec(n);if(e){let t=e[2].replace(/\n/g," ");const o=/[^ ]/.test(t),s=/^ /.test(t)&&/ $/.test(t);return o&&s&&(t=t.substring(1,t.length-1)),t=Se(t,!0),{type:"codespan",raw:e[0],text:t}}}br(n){const e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}}del(n){const e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(n){const e=this.rules.inline.autolink.exec(n);if(e){let t,o;return e[2]==="@"?(t=Se(e[1]),o="mailto:"+t):(t=Se(e[1]),o=t),{type:"link",raw:e[0],text:t,href:o,tokens:[{type:"text",raw:t,text:t}]}}}url(n){var t;let e;if(e=this.rules.inline.url.exec(n)){let o,s;if(e[2]==="@")o=Se(e[0]),s="mailto:"+o;else{let l;do l=e[0],e[0]=((t=this.rules.inline._backpedal.exec(e[0]))==null?void 0:t[0])??"";while(l!==e[0]);o=Se(e[0]),e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:o,href:s,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(n){const e=this.rules.inline.text.exec(n);if(e){let t;return this.lexer.state.inRawBlock?t=e[0]:t=Se(e[0]),{type:"text",raw:e[0],text:t}}}}const Ls=/^(?: *(?:\n|$))+/,Ps=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,Ds=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,kt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Es=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,On=/(?:[*+-]|\d{1,9}[.)])/,Un=se(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,On).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),an=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,qs=/^[^\n]+/,rn=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Bs=se(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",rn).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Os=se(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,On).getRegex(),Lt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",un=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Us=se("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",un).replace("tag",Lt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Nn=se(an).replace("hr",kt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Lt).getRegex(),Ns=se(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Nn).getRegex(),cn={blockquote:Ns,code:Ps,def:Bs,fences:Ds,heading:Es,hr:kt,html:Us,lheading:Un,list:Os,newline:Ls,paragraph:Nn,table:_t,text:qs},In=se("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",kt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Lt).getRegex(),Hs={...cn,table:In,paragraph:se(an).replace("hr",kt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",In).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Lt).getRegex()},Fs={...cn,html:se(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",un).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:_t,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:se(an).replace("hr",kt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Un).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Hn=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Zs=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Fn=/^( {2,}|\\)\n(?!\s*$)/,Ws=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,xt="\\p{P}\\p{S}",Qs=se(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,xt).getRegex(),Vs=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,Gs=se(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,xt).getRegex(),Js=se("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,xt).getRegex(),Ks=se("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,xt).getRegex(),Xs=se(/\\([punct])/,"gu").replace(/punct/g,xt).getRegex(),Ys=se(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),el=se(un).replace("(?:-->|$)","-->").getRegex(),tl=se("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",el).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),It=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,nl=se(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",It).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Zn=se(/^!?\[(label)\]\[(ref)\]/).replace("label",It).replace("ref",rn).getRegex(),Wn=se(/^!?\[(ref)\](?:\[\])?/).replace("ref",rn).getRegex(),sl=se("reflink|nolink(?!\\()","g").replace("reflink",Zn).replace("nolink",Wn).getRegex(),dn={_backpedal:_t,anyPunctuation:Xs,autolink:Ys,blockSkip:Vs,br:Fn,code:Zs,del:_t,emStrongLDelim:Gs,emStrongRDelimAst:Js,emStrongRDelimUnd:Ks,escape:Hn,link:nl,nolink:Wn,punctuation:Qs,reflink:Zn,reflinkSearch:sl,tag:tl,text:Ws,url:_t},ll={...dn,link:se(/^!?\[(label)\]\((.*?)\)/).replace("label",It).getRegex(),reflink:se(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",It).getRegex()},en={...dn,escape:se(Hn).replace("])","~|])").getRegex(),url:se(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},ol={...en,br:se(Fn).replace("{2,}","*").getRegex(),text:se(en.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Tt={normal:cn,gfm:Hs,pedantic:Fs},gt={normal:dn,gfm:en,breaks:ol,pedantic:ll};class Ue{constructor(n){ue(this,"tokens");ue(this,"options");ue(this,"state");ue(this,"tokenizer");ue(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=n||nt,this.options.tokenizer=this.options.tokenizer||new St,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={block:Tt.normal,inline:gt.normal};this.options.pedantic?(e.block=Tt.pedantic,e.inline=gt.pedantic):this.options.gfm&&(e.block=Tt.gfm,this.options.breaks?e.inline=gt.breaks:e.inline=gt.gfm),this.tokenizer.rules=e}static get rules(){return{block:Tt,inline:gt}}static lex(n,e){return new Ue(e).lex(n)}static lexInline(n,e){return new Ue(e).inlineTokens(n)}lex(n){n=n.replace(/\r\n|\r/g,`
`),this.blockTokens(n,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(n,e=[]){this.options.pedantic?n=n.replace(/\t/g,"    ").replace(/^ +$/gm,""):n=n.replace(/^( *)(\t+)/gm,(c,m,T)=>m+"    ".repeat(T.length));let t,o,s,l;for(;n;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(c=>(t=c.call({lexer:this},n,e))?(n=n.substring(t.raw.length),e.push(t),!0):!1))){if(t=this.tokenizer.space(n)){n=n.substring(t.raw.length),t.raw.length===1&&e.length>0?e[e.length-1].raw+=`
`:e.push(t);continue}if(t=this.tokenizer.code(n)){n=n.substring(t.raw.length),o=e[e.length-1],o&&(o.type==="paragraph"||o.type==="text")?(o.raw+=`
`+t.raw,o.text+=`
`+t.text,this.inlineQueue[this.inlineQueue.length-1].src=o.text):e.push(t);continue}if(t=this.tokenizer.fences(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.heading(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.hr(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.blockquote(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.list(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.html(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.def(n)){n=n.substring(t.raw.length),o=e[e.length-1],o&&(o.type==="paragraph"||o.type==="text")?(o.raw+=`
`+t.raw,o.text+=`
`+t.raw,this.inlineQueue[this.inlineQueue.length-1].src=o.text):this.tokens.links[t.tag]||(this.tokens.links[t.tag]={href:t.href,title:t.title});continue}if(t=this.tokenizer.table(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.lheading(n)){n=n.substring(t.raw.length),e.push(t);continue}if(s=n,this.options.extensions&&this.options.extensions.startBlock){let c=1/0;const m=n.slice(1);let T;this.options.extensions.startBlock.forEach(_=>{T=_.call({lexer:this},m),typeof T=="number"&&T>=0&&(c=Math.min(c,T))}),c<1/0&&c>=0&&(s=n.substring(0,c+1))}if(this.state.top&&(t=this.tokenizer.paragraph(s))){o=e[e.length-1],l&&o.type==="paragraph"?(o.raw+=`
`+t.raw,o.text+=`
`+t.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=o.text):e.push(t),l=s.length!==n.length,n=n.substring(t.raw.length);continue}if(t=this.tokenizer.text(n)){n=n.substring(t.raw.length),o=e[e.length-1],o&&o.type==="text"?(o.raw+=`
`+t.raw,o.text+=`
`+t.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=o.text):e.push(t);continue}if(n){const c="Infinite loop on byte: "+n.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,e}inline(n,e=[]){return this.inlineQueue.push({src:n,tokens:e}),e}inlineTokens(n,e=[]){let t,o,s,l=n,c,m,T;if(this.tokens.links){const _=Object.keys(this.tokens.links);if(_.length>0)for(;(c=this.tokenizer.rules.inline.reflinkSearch.exec(l))!=null;)_.includes(c[0].slice(c[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,c.index)+"["+"a".repeat(c[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(c=this.tokenizer.rules.inline.blockSkip.exec(l))!=null;)l=l.slice(0,c.index)+"["+"a".repeat(c[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(c=this.tokenizer.rules.inline.anyPunctuation.exec(l))!=null;)l=l.slice(0,c.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;n;)if(m||(T=""),m=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(_=>(t=_.call({lexer:this},n,e))?(n=n.substring(t.raw.length),e.push(t),!0):!1))){if(t=this.tokenizer.escape(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.tag(n)){n=n.substring(t.raw.length),o=e[e.length-1],o&&t.type==="text"&&o.type==="text"?(o.raw+=t.raw,o.text+=t.text):e.push(t);continue}if(t=this.tokenizer.link(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.reflink(n,this.tokens.links)){n=n.substring(t.raw.length),o=e[e.length-1],o&&t.type==="text"&&o.type==="text"?(o.raw+=t.raw,o.text+=t.text):e.push(t);continue}if(t=this.tokenizer.emStrong(n,l,T)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.codespan(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.br(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.del(n)){n=n.substring(t.raw.length),e.push(t);continue}if(t=this.tokenizer.autolink(n)){n=n.substring(t.raw.length),e.push(t);continue}if(!this.state.inLink&&(t=this.tokenizer.url(n))){n=n.substring(t.raw.length),e.push(t);continue}if(s=n,this.options.extensions&&this.options.extensions.startInline){let _=1/0;const f=n.slice(1);let v;this.options.extensions.startInline.forEach(S=>{v=S.call({lexer:this},f),typeof v=="number"&&v>=0&&(_=Math.min(_,v))}),_<1/0&&_>=0&&(s=n.substring(0,_+1))}if(t=this.tokenizer.inlineText(s)){n=n.substring(t.raw.length),t.raw.slice(-1)!=="_"&&(T=t.raw.slice(-1)),m=!0,o=e[e.length-1],o&&o.type==="text"?(o.raw+=t.raw,o.text+=t.text):e.push(t);continue}if(n){const _="Infinite loop on byte: "+n.charCodeAt(0);if(this.options.silent){console.error(_);break}else throw new Error(_)}}return e}}class Mt{constructor(n){ue(this,"options");this.options=n||nt}code(n,e,t){var s;const o=(s=(e||"").match(/^\S*/))==null?void 0:s[0];return n=n.replace(/\n$/,"")+`
`,o?'<pre><code class="language-'+Se(o)+'">'+(t?n:Se(n,!0))+`</code></pre>
`:"<pre><code>"+(t?n:Se(n,!0))+`</code></pre>
`}blockquote(n){return`<blockquote>
${n}</blockquote>
`}html(n,e){return n}heading(n,e,t){return`<h${e}>${n}</h${e}>
`}hr(){return`<hr>
`}list(n,e,t){const o=e?"ol":"ul",s=e&&t!==1?' start="'+t+'"':"";return"<"+o+s+`>
`+n+"</"+o+`>
`}listitem(n,e,t){return`<li>${n}</li>
`}checkbox(n){return"<input "+(n?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(n){return`<p>${n}</p>
`}table(n,e){return e&&(e=`<tbody>${e}</tbody>`),`<table>
<thead>
`+n+`</thead>
`+e+`</table>
`}tablerow(n){return`<tr>
${n}</tr>
`}tablecell(n,e){const t=e.header?"th":"td";return(e.align?`<${t} align="${e.align}">`:`<${t}>`)+n+`</${t}>
`}strong(n){return`<strong>${n}</strong>`}em(n){return`<em>${n}</em>`}codespan(n){return`<code>${n}</code>`}br(){return"<br>"}del(n){return`<del>${n}</del>`}link(n,e,t){const o=Tn(n);if(o===null)return t;n=o;let s='<a href="'+n+'"';return e&&(s+=' title="'+e+'"'),s+=">"+t+"</a>",s}image(n,e,t){const o=Tn(n);if(o===null)return t;n=o;let s=`<img src="${n}" alt="${t}"`;return e&&(s+=` title="${e}"`),s+=">",s}text(n){return n}}class pn{strong(n){return n}em(n){return n}codespan(n){return n}del(n){return n}html(n){return n}text(n){return n}link(n,e,t){return""+t}image(n,e,t){return""+t}br(){return""}}class Ne{constructor(n){ue(this,"options");ue(this,"renderer");ue(this,"textRenderer");this.options=n||nt,this.options.renderer=this.options.renderer||new Mt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new pn}static parse(n,e){return new Ne(e).parse(n)}static parseInline(n,e){return new Ne(e).parseInline(n)}parse(n,e=!0){let t="";for(let o=0;o<n.length;o++){const s=n[o];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]){const l=s,c=this.options.extensions.renderers[l.type].call({parser:this},l);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(l.type)){t+=c||"";continue}}switch(s.type){case"space":continue;case"hr":{t+=this.renderer.hr();continue}case"heading":{const l=s;t+=this.renderer.heading(this.parseInline(l.tokens),l.depth,Ms(this.parseInline(l.tokens,this.textRenderer)));continue}case"code":{const l=s;t+=this.renderer.code(l.text,l.lang,!!l.escaped);continue}case"table":{const l=s;let c="",m="";for(let _=0;_<l.header.length;_++)m+=this.renderer.tablecell(this.parseInline(l.header[_].tokens),{header:!0,align:l.align[_]});c+=this.renderer.tablerow(m);let T="";for(let _=0;_<l.rows.length;_++){const f=l.rows[_];m="";for(let v=0;v<f.length;v++)m+=this.renderer.tablecell(this.parseInline(f[v].tokens),{header:!1,align:l.align[v]});T+=this.renderer.tablerow(m)}t+=this.renderer.table(c,T);continue}case"blockquote":{const l=s,c=this.parse(l.tokens);t+=this.renderer.blockquote(c);continue}case"list":{const l=s,c=l.ordered,m=l.start,T=l.loose;let _="";for(let f=0;f<l.items.length;f++){const v=l.items[f],S=v.checked,w=v.task;let I="";if(v.task){const F=this.renderer.checkbox(!!S);T?v.tokens.length>0&&v.tokens[0].type==="paragraph"?(v.tokens[0].text=F+" "+v.tokens[0].text,v.tokens[0].tokens&&v.tokens[0].tokens.length>0&&v.tokens[0].tokens[0].type==="text"&&(v.tokens[0].tokens[0].text=F+" "+v.tokens[0].tokens[0].text)):v.tokens.unshift({type:"text",text:F+" "}):I+=F+" "}I+=this.parse(v.tokens,T),_+=this.renderer.listitem(I,w,!!S)}t+=this.renderer.list(_,c,m);continue}case"html":{const l=s;t+=this.renderer.html(l.text,l.block);continue}case"paragraph":{const l=s;t+=this.renderer.paragraph(this.parseInline(l.tokens));continue}case"text":{let l=s,c=l.tokens?this.parseInline(l.tokens):l.text;for(;o+1<n.length&&n[o+1].type==="text";)l=n[++o],c+=`
`+(l.tokens?this.parseInline(l.tokens):l.text);t+=e?this.renderer.paragraph(c):c;continue}default:{const l='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return t}parseInline(n,e){e=e||this.renderer;let t="";for(let o=0;o<n.length;o++){const s=n[o];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]){const l=this.options.extensions.renderers[s.type].call({parser:this},s);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){t+=l||"";continue}}switch(s.type){case"escape":{const l=s;t+=e.text(l.text);break}case"html":{const l=s;t+=e.html(l.text);break}case"link":{const l=s;t+=e.link(l.href,l.title,this.parseInline(l.tokens,e));break}case"image":{const l=s;t+=e.image(l.href,l.title,l.text);break}case"strong":{const l=s;t+=e.strong(this.parseInline(l.tokens,e));break}case"em":{const l=s;t+=e.em(this.parseInline(l.tokens,e));break}case"codespan":{const l=s;t+=e.codespan(l.text);break}case"br":{t+=e.br();break}case"del":{const l=s;t+=e.del(this.parseInline(l.tokens,e));break}case"text":{const l=s;t+=e.text(l.text);break}default:{const l='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return t}}class yt{constructor(n){ue(this,"options");this.options=n||nt}preprocess(n){return n}postprocess(n){return n}processAllTokens(n){return n}}ue(yt,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var tt,tn,Qn;class al{constructor(...n){bn(this,tt);ue(this,"defaults",on());ue(this,"options",this.setOptions);ue(this,"parse",Ct(this,tt,tn).call(this,Ue.lex,Ne.parse));ue(this,"parseInline",Ct(this,tt,tn).call(this,Ue.lexInline,Ne.parseInline));ue(this,"Parser",Ne);ue(this,"Renderer",Mt);ue(this,"TextRenderer",pn);ue(this,"Lexer",Ue);ue(this,"Tokenizer",St);ue(this,"Hooks",yt);this.use(...n)}walkTokens(n,e){var o,s;let t=[];for(const l of n)switch(t=t.concat(e.call(this,l)),l.type){case"table":{const c=l;for(const m of c.header)t=t.concat(this.walkTokens(m.tokens,e));for(const m of c.rows)for(const T of m)t=t.concat(this.walkTokens(T.tokens,e));break}case"list":{const c=l;t=t.concat(this.walkTokens(c.items,e));break}default:{const c=l;(s=(o=this.defaults.extensions)==null?void 0:o.childTokens)!=null&&s[c.type]?this.defaults.extensions.childTokens[c.type].forEach(m=>{const T=c[m].flat(1/0);t=t.concat(this.walkTokens(T,e))}):c.tokens&&(t=t.concat(this.walkTokens(c.tokens,e)))}}return t}use(...n){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{const o={...t};if(o.async=this.defaults.async||o.async||!1,t.extensions&&(t.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){const l=e.renderers[s.name];l?e.renderers[s.name]=function(...c){let m=s.renderer.apply(this,c);return m===!1&&(m=l.apply(this,c)),m}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const l=e[s.level];l?l.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),o.extensions=e),t.renderer){const s=this.defaults.renderer||new Mt(this.defaults);for(const l in t.renderer){if(!(l in s))throw new Error(`renderer '${l}' does not exist`);if(l==="options")continue;const c=l,m=t.renderer[c],T=s[c];s[c]=(..._)=>{let f=m.apply(s,_);return f===!1&&(f=T.apply(s,_)),f||""}}o.renderer=s}if(t.tokenizer){const s=this.defaults.tokenizer||new St(this.defaults);for(const l in t.tokenizer){if(!(l in s))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;const c=l,m=t.tokenizer[c],T=s[c];s[c]=(..._)=>{let f=m.apply(s,_);return f===!1&&(f=T.apply(s,_)),f}}o.tokenizer=s}if(t.hooks){const s=this.defaults.hooks||new yt;for(const l in t.hooks){if(!(l in s))throw new Error(`hook '${l}' does not exist`);if(l==="options")continue;const c=l,m=t.hooks[c],T=s[c];yt.passThroughHooks.has(l)?s[c]=_=>{if(this.defaults.async)return Promise.resolve(m.call(s,_)).then(v=>T.call(s,v));const f=m.call(s,_);return T.call(s,f)}:s[c]=(..._)=>{let f=m.apply(s,_);return f===!1&&(f=T.apply(s,_)),f}}o.hooks=s}if(t.walkTokens){const s=this.defaults.walkTokens,l=t.walkTokens;o.walkTokens=function(c){let m=[];return m.push(l.call(this,c)),s&&(m=m.concat(s.call(this,c))),m}}this.defaults={...this.defaults,...o}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return Ue.lex(n,e??this.defaults)}parser(n,e){return Ne.parse(n,e??this.defaults)}}tt=new WeakSet,tn=function(n,e){return(t,o)=>{const s={...o},l={...this.defaults,...s};this.defaults.async===!0&&s.async===!1&&(l.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),l.async=!0);const c=Ct(this,tt,Qn).call(this,!!l.silent,!!l.async);if(typeof t>"u"||t===null)return c(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return c(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(l.hooks&&(l.hooks.options=l),l.async)return Promise.resolve(l.hooks?l.hooks.preprocess(t):t).then(m=>n(m,l)).then(m=>l.hooks?l.hooks.processAllTokens(m):m).then(m=>l.walkTokens?Promise.all(this.walkTokens(m,l.walkTokens)).then(()=>m):m).then(m=>e(m,l)).then(m=>l.hooks?l.hooks.postprocess(m):m).catch(c);try{l.hooks&&(t=l.hooks.preprocess(t));let m=n(t,l);l.hooks&&(m=l.hooks.processAllTokens(m)),l.walkTokens&&this.walkTokens(m,l.walkTokens);let T=e(m,l);return l.hooks&&(T=l.hooks.postprocess(T)),T}catch(m){return c(m)}}},Qn=function(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){const o="<p>An error occurred:</p><pre>"+Se(t.message+"",!0)+"</pre>";return e?Promise.resolve(o):o}if(e)return Promise.reject(t);throw t}};const et=new al;function ee(a,n){return et.parse(a,n)}ee.options=ee.setOptions=function(a){return et.setOptions(a),ee.defaults=et.defaults,En(ee.defaults),ee};ee.getDefaults=on;ee.defaults=nt;ee.use=function(...a){return et.use(...a),ee.defaults=et.defaults,En(ee.defaults),ee};ee.walkTokens=function(a,n){return et.walkTokens(a,n)};ee.parseInline=et.parseInline;ee.Parser=Ne;ee.parser=Ne.parse;ee.Renderer=Mt;ee.TextRenderer=pn;ee.Lexer=Ue;ee.lexer=Ue.lex;ee.Tokenizer=St;ee.Hooks=yt;ee.parse=ee;ee.options;ee.setOptions;ee.use;ee.walkTokens;ee.parseInline;Ne.parse;Ue.lex;function qe(a){if(!a)return"";try{return ee.parse(a,{async:!1})}catch{return a.replace(/\n/g,"<br>")}}function Jt(a){const n=a&&!a.endsWith("Z")&&!a.includes("+")?a+"Z":a;return new Date(n).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}function $e(a){return a?a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(0)}K`:`${a}`:"0"}function il(a){function n(){Xt(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight)})}function e(){Xt(()=>{a.value&&(a.value.scrollTop=0)})}return{scrollToBottom:n,scrollToTop:e}}function Vn(a,n){const e={...n||{}},t=a.match(/Rate limit.*?(\d+)\s*per\s*(\d+)s/i);t&&(e.error_type=e.error_type||"rate_limit",e.rate_limit=`${t[1]} per ${t[2]}s`,e.rate_limit_count=parseInt(t[1]),e.rate_limit_seconds=parseInt(t[2]));const o=a.match(/wait\s+(\d+)\s*seconds?/i);o&&(e.wait_seconds=parseInt(o[1]),e.error_type=e.error_type||"rate_limit");const s=a.match(/maximum context length.*?(\d{3,})/i);s&&(e.error_type=e.error_type||"context_overflow",e.max_context_tokens=parseInt(s[1]));const l=a.match(/Max size:\s*(\d+)\s*tokens/i);l&&(e.error_type=e.error_type||"context_overflow",e.max_context_tokens=parseInt(l[1]));const c=a.match(/requested\s+(\d+)\s*tokens/i);return c&&(e.requested_tokens=parseInt(c[1])),e.error_type==="rate_limit"?e.summary=`ðŸš¦ é€ŸçŽ‡é™åˆ¶ (${e.rate_limit||""}${e.wait_seconds?`, ç­‰å¾… ${e.wait_seconds}s`:""})`:e.error_type==="context_overflow"?e.summary=`ðŸ“ ä¸Šä¸‹æ–‡è¶…é™ (æœ€å¤§ ${$e(e.max_context_tokens||0)})`:e.error_type==="auth_error"?e.summary="ðŸ”’ è®¤è¯é”™è¯¯ï¼Œè¯·æ£€æŸ¥æŽˆæƒçŠ¶æ€":e.summary="âš ï¸ AI æœåŠ¡é”™è¯¯",e}function jt(a,n){const e=[`**âš ï¸ AI æœåŠ¡é”™è¯¯**
`];if(n.error_type==="rate_limit")n.rate_limit_count&&n.rate_limit_seconds&&e.push(`> ðŸš¦ **é€ŸçŽ‡é™åˆ¶**: æ¯ ${n.rate_limit_seconds}ç§’ æœ€å¤š ${n.rate_limit_count} æ¬¡è¯·æ±‚`),n.wait_seconds&&e.push(`> â±ï¸ **ç­‰å¾…**: ${n.wait_seconds} ç§’åŽå¯é‡è¯•`),e.push(`
ðŸ’¡ *å»ºè®®ï¼šç¨åŽé‡æ–°å‘é€æ¶ˆæ¯ï¼Œæˆ–åˆ‡æ¢åˆ°å…¶ä»–æ¨¡åž‹*`);else if(n.error_type==="context_overflow"){const t=n.max_context_tokens;t&&e.push(`> ðŸ“ **ä¸Šä¸‹æ–‡è¶…é™**: æ¨¡åž‹æœ€å¤§ ${$e(t)} tokens`),n.requested_tokens&&e.push(`> ðŸ“Š **å®žé™…è¯·æ±‚**: ${$e(n.requested_tokens)} tokens`),e.push(`
ðŸ’¡ *å»ºè®®ï¼šåˆ é™¤éƒ¨åˆ†åŽ†å²æ¶ˆæ¯ï¼Œæˆ–åˆ‡æ¢åˆ°ä¸Šä¸‹æ–‡æ›´å¤§çš„æ¨¡åž‹*`)}else if(n.error_type==="auth_error")e.push("> ðŸ”’ **è®¤è¯å¤±è´¥**: è¯·å‰å¾€è®¾ç½®é¡µé¢æ£€æŸ¥ Copilot æŽˆæƒçŠ¶æ€");else{const t=a.length>300?a.slice(0,300)+"...":a;e.push("```\n"+t+"\n```")}return e.join(`
`)}const Kt={},Mn=["#0ea5e9","#a855f7","#22c55e","#f59e0b","#ec4899","#06b6d4","#84cc16"];let jn=0;function rl(a){return!a||a==="assistant"?"#e94560":(Kt[a]||(Kt[a]=Mn[jn%Mn.length],jn++),Kt[a])}const ul={read_file:"ðŸ“– è¯»å–æ–‡ä»¶",search_text:"ðŸ” æœç´¢",list_directory:"ðŸ“‚ åˆ—ç›®å½•",get_file_tree:"ðŸŒ³ ç›®å½•æ ‘",ask_user:"â“ æé—®"};function An(a){return ul[a]||a}function Rn(a,n){if(!n)return"";if(a==="read_file"){let e=n.path||"";return n.start_line&&(e+=` L${n.start_line}`),n.end_line&&(e+=`-${n.end_line}`),e}if(a==="search_text"){let e=`"${n.query||""}"`;return n.include_pattern&&(e+=` in ${n.include_pattern}`),e}return a==="list_directory"||a==="get_file_tree"?n.path||".":a==="ask_user"?`${Te(n).length} ä¸ªé—®é¢˜`:JSON.stringify(n)}function Te(a){if(!(a!=null&&a.questions))return[];try{const n=typeof a.questions=="string"?JSON.parse(a.questions):a.questions;return Array.isArray(n)?n.map(e=>({question:e.question||"",type:e.type==="multi"?"multi":"single",options:(e.options||[]).map(t=>typeof t=="string"?{label:t}:{label:t.label||"",description:t.description,recommended:!!t.recommended}),context:e.context})):[]}catch{return[]}}function $t(a){var e;const n=(e=a.options)==null?void 0:e.filter(t=>t.recommended);return n!=null&&n.length?n.map(t=>t.label).join("ã€"):""}function cl(a){const n=Ze(),e=Rt(),t=U([]),o=U(a),s=U(!1),l=G({get:()=>e.chatModelSourceFilter,set:y=>{e.chatModelSourceFilter=y}}),c=G(()=>{const y=[{label:"å…¨éƒ¨",key:"all"},{label:"GitHub (å…è´¹)",key:"github"}];t.value.some(M=>M.api_backend==="copilot")&&y.push({label:"Copilot (ä»˜è´¹)",key:"copilot"});const H=new Set;for(const M of t.value){const g=M.provider_slug||"";g&&g!=="github"&&g!=="copilot"&&!H.has(g)&&(H.add(g),y.push({label:M.publisher||g,key:g}))}return e.customModelsEnabled&&y.push({label:"ðŸ§© è¡¥å……æ¨¡åž‹",key:"custom"}),y}),m=G(()=>{const y=c.value.find(H=>H.key===l.value);return(y==null?void 0:y.label)||"å…¨éƒ¨"});function T(y){if(y==="custom"&&!e.customModelsEnabled){l.value="all";return}l.value=y}const _=G(()=>{const y=t.value.filter(R=>R.category==="discussion"||R.category==="both"),M=(l.value==="all"?y:l.value==="copilot"?y.filter(R=>R.provider_slug==="copilot"||R.api_backend==="copilot"):l.value==="custom"?y.filter(R=>R.is_custom):l.value==="github"?y.filter(R=>R.provider_slug==="github"||!R.provider_slug&&R.api_backend==="models"):y.filter(R=>R.provider_slug===l.value)).filter(R=>e.isModelVisible(R)),g=R=>({label:R.name,value:R.id,description:R.summary||R.description||"",supports_vision:R.supports_vision,supports_tools:R.supports_tools,is_reasoning:R.is_reasoning,api_backend:R.api_backend,is_custom:R.is_custom,provider_slug:R.provider_slug||(R.api_backend==="copilot"?"copilot":"github"),pricing_tier:R.pricing_tier,premium_multiplier:R.premium_multiplier,is_deprecated:R.is_deprecated,pricing_note:R.pricing_note,max_input_tokens:e.getEffectiveMaxInput(R.id,R.max_input_tokens||0),max_output_tokens:R.max_output_tokens||0}),$=[],N={};for(const R of M){const ce=R.model_family||R.publisher||R.provider_slug||"Other",de=R.provider_slug||(R.api_backend==="copilot"?"copilot":"github"),ne=de+":"+ce;if(!N[ne]){const q={key:ne,label:ce,slug:de,items:[]};$.push(q),N[ne]=q}N[ne].items.push(R)}return $.map(R=>({type:"group",label:R.label,key:R.key,provider_slug:R.slug,children:R.items.map(g)}))}),f=G(()=>{const y=t.value.find(H=>H.id===o.value);return y?{supports_vision:!!y.supports_vision,supports_tools:!!y.supports_tools}:{supports_vision:!1,supports_tools:!1}}),v=G(()=>{const y=t.value.find(M=>M.id===o.value);if(!y)return o.value;const H=y.is_custom?" ðŸ§©":"";return`${o.value}${H}`}),S=G(()=>{const y=t.value.find(M=>M.id===o.value);if(!y)return"";const H=y.provider_slug||(y.api_backend==="copilot"?"copilot":"github");return Gt(H,"",12)}),w=G(()=>{const y=t.value.find(H=>H.id===o.value);return y&&(e.getEffectiveMaxInput(y.id,y.max_input_tokens||0)||y.max_input_tokens)||0}),I=G(()=>{const y=t.value.find(H=>H.id===o.value);return y?e.getToolRounds(y):e.freeToolRounds});function F(y,H){if(y.type==="group"){const X=Gt(y.provider_slug||"github",y.label,14);return Ye("span",{style:"display:inline-flex;align-items:center;gap:4px"},[Ye("span",{innerHTML:X,style:"display:inline-flex"}),y.label])}const M=[];y.is_reasoning&&M.push("ðŸ§ "),y.supports_vision&&M.push("ðŸ‘ï¸"),y.supports_tools&&M.push("ðŸ”§");const g=y.is_deprecated?" âš ï¸":"",$=M.length?` ${M.join("")}`:"",N=Gt(y.provider_slug||"github","",12),R=Ye("span",{innerHTML:N,style:"display:inline-flex;vertical-align:middle;margin:0 2px"}),ce=y.is_custom?" ðŸ§©":"",de=y.pricing_note||"x0",ne=y.max_input_tokens?$e(y.max_input_tokens):"",q=H?"font-weight:600":"",P=H?"color:#18a058;font-size:11px;flex-shrink:0;margin-left:8px;font-weight:600":"color:#888;font-size:11px;flex-shrink:0;margin-left:8px";return Ye("div",{style:"display:flex;justify-content:space-between;align-items:center;width:100%"},[Ye("span",{style:q},[H?"â— ":"",y.label," ",R,ce,$,g]),Ye("span",{style:P},[ne?Ye("span",{style:"color:#666;margin-right:6px"},ne):null,de])])}async function D(){var y,H;s.value=!0;try{await Wt.refresh();const{data:M}=await Wt.list({category:"discussion",custom_models:e.customModelsEnabled});t.value=M,n.success(`å·²åˆ·æ–°ï¼Œå…± ${M.length} ä¸ªå¯ç”¨æ¨¡åž‹`)}catch(M){n.error("åˆ·æ–°æ¨¡åž‹åˆ—è¡¨å¤±è´¥: "+(((H=(y=M.response)==null?void 0:y.data)==null?void 0:H.detail)||M.message))}finally{s.value=!1}}async function E(){try{const{data:y}=await Wt.list({category:"discussion",custom_models:e.customModelsEnabled});t.value=y,y.length&&!y.find(H=>H.id===o.value)&&(o.value=y[0].id)}catch{}}return{models:t,selectedModel:o,loadingModels:s,modelSourceFilter:l,sourceFilterOptions:c,sourceFilterLabel:m,modelOptions:_,currentModelCaps:f,selectedModelDisplay:v,selectedModelProviderIcon:S,selectedModelMaxTokens:w,currentModelToolRounds:I,onSourceFilterChange:T,renderModelLabel:F,refreshModels:D,loadModels:E}}function dl(a){const n=Ze(),e=At(),t=U(null),o=U(!1),s=U(!1);let l=0;const c=U(!1),m=U(""),T=U(""),_=Dn({});function f(){const g=a.selectedModel.value;!g||!a.projectId()||we.checkContext(a.projectId(),g).then(({data:$})=>{$!=null&&$.context&&(t.value=$.context)}).catch(()=>{})}const v=G(()=>{const g=a.selectedModelMaxTokens.value;if(t.value){const $=t.value.used||0,N=g||t.value.total||1,R=Math.min(100,Math.round($*100/Math.max(N,1)));return{used:$,total:N,percentage:R}}return{used:0,total:g||0,percentage:0}}),S=G(()=>{var $;const g=($=t.value)==null?void 0:$.breakdown;return{system:(g==null?void 0:g.system)||0,tools:(g==null?void 0:g.tools)||0,history:(g==null?void 0:g.history)||0}}),w=G(()=>{var $;const g=($=t.value)==null?void 0:$.messages;return{kept:(g==null?void 0:g.kept)||0,dropped:(g==null?void 0:g.dropped)||0,total:(g==null?void 0:g.total)||0}}),I=G(()=>{const g=v.value.total||1;return{system:Math.round(S.value.system*100/g),tools:Math.round(S.value.tools*100/g),history:Math.round(S.value.history*100/g)}}),F=G(()=>{var g;return((g=t.value)==null?void 0:g.system_sections)||[]}),D=G(()=>{var g;return((g=t.value)==null?void 0:g.history_detail)||[]});function E(g,$){$&&(m.value=g,T.value=$,c.value=!0)}async function y(){var g,$;s.value=!0;try{const{data:N}=await we.summarizeContext(a.projectId());n.success(`å·²æ€»ç»“ ${N.summarized_count} æ¡æ—§æ¶ˆæ¯ â†’ 1 æ¡æ‘˜è¦`);const{data:R}=await we.getMessages(a.projectId());a.messages.value=R,a.scrollToBottom(),f()}catch(N){n.error((($=(g=N.response)==null?void 0:g.data)==null?void 0:$.detail)||"æ€»ç»“å¤±è´¥")}finally{s.value=!1}}function H(){e.warning({title:"ç¡®è®¤æ¸…ç©º",content:"å°†åˆ é™¤æ‰€æœ‰è®¨è®ºæ¶ˆæ¯ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®å®šæ¸…ç©ºï¼Ÿ",positiveText:"æ¸…ç©º",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{var g,$;try{await we.clearContext(a.projectId()),a.messages.value=[],t.value=null,n.success("å·²æ¸…ç©ºæ‰€æœ‰è®¨è®ºæ¶ˆæ¯")}catch(N){n.error((($=(g=N.response)==null?void 0:g.data)==null?void 0:$.detail)||"æ¸…ç©ºå¤±è´¥")}}})}async function M(g){try{await vt.update(a.projectId(),{discussion_model:g})}catch{}const $=++l;o.value=!0;try{const{data:N}=await we.checkContext(a.projectId(),g);if($!==l)return;N.context&&(t.value=N.context),N.summarized&&N.summary_text&&n.info("ä¸Šä¸‹æ–‡å·²è‡ªåŠ¨åŽ‹ç¼©ä»¥é€‚åº”æ–°æ¨¡åž‹çª—å£")}catch{}finally{$===l&&(o.value=!1)}}return{persistentContextInfo:t,contextCompressing:o,summarizing:s,ctxContentModal:c,ctxContentTitle:m,ctxContentText:T,ctxExpanded:_,displayContextInfo:v,ctxBreakdown:S,ctxMessages:w,ctxBreakdownPercents:I,ctxSystemSections:F,ctxHistoryDetail:D,refreshContextInfo:f,openCtxContent:E,handleSummarize:y,handleClearContext:H,handleModelChange:M}}function pl(a){const n=ln(),e=Rt(),t=U(new Map),o=U(new Set);let s=null,l=null,c=0;function m(w){return G(()=>t.value.size>0||w.value)}function T(){_(),s=new AbortController;const w=Yt.projectEventsUrl(a.projectId()),I={};n.token&&(I.Authorization=`Bearer ${n.token}`),fetch(w,{headers:I,signal:s.signal}).then(F=>f(F)).catch(F=>{F.name!=="AbortError"&&(l=setTimeout(T,3e3))})}function _(){l&&(clearTimeout(l),l=null),s&&(s.abort(),s=null)}async function f(w){var D;const I=(D=w.body)==null?void 0:D.getReader(),F=new TextDecoder;if(I){try{let E=0;for(;;){const{done:y,value:H}=await I.read();if(y)break;const g=F.decode(H,{stream:!0}).split(`
`);for(const $ of g)if($.startsWith("data: "))try{const N=JSON.parse($.slice(6));v(N),E++,E%5===0&&(await new Promise(R=>setTimeout(R,0)),a.scrollToBottom())}catch{}}}catch(E){if(E.name==="AbortError")return}s&&!s.signal.aborted&&(l=setTimeout(T,1e3))}}function v(w){const I=w.type,F=w.task_id;if(I==="new_message"){const E=w.message;E!=null&&E.id&&!a.messages.value.find(y=>y.id===E.id)&&(a.messages.value.push(E),a.scrollToBottom());return}if(I==="message_deleted"){a.messages.value=a.messages.value.filter(E=>E.id!==w.message_id);return}if(I==="heartbeat")return;if(I==="task_started"){F&&!t.value.has(F)&&(t.value.set(F,{taskId:F,model:w.model||"",senderName:w.sender_name||"",content:"",thinking:"",toolCalls:[],segments:[],tokenUsage:null}),a.scrollToBottom());return}if(!F)return;let D=t.value.get(F);if(D||(D={taskId:F,model:w.model||"",senderName:w.sender_name||"",content:"",thinking:"",toolCalls:[],segments:[],tokenUsage:null},t.value.set(F,D)),I==="content"){const E=w.content||"";D.content+=E;const y=D.segments[D.segments.length-1];y&&y.type==="content"?y.text=(y.text||"")+E:D.segments.push({type:"content",text:E})}else if(I==="thinking")D.thinking+=w.content||"";else if(I==="context")a.persistentContextInfo.value=w.context;else if(I==="tool_call_start"){const E=w.tool_call||w,y={id:E.id||"",name:E.name||"",arguments:null,status:"preparing"};D.toolCalls.push(y),D.segments.push({type:"tool",toolCall:y})}else if(I==="tool_call"){const E=w.tool_call||w,y=E.id||w.tool_call_id||"",H=D.toolCalls.find(M=>M.id===y);if(H)H.arguments=E.arguments||w.arguments||"",H.status="calling";else{const M={id:y,name:E.name||w.name||"",arguments:E.arguments||w.arguments||"",status:"calling"};D.toolCalls.push(M),D.segments.push({type:"tool",toolCall:M})}}else if(I==="tool_result"){const E=D.toolCalls.find(y=>y.id===w.tool_call_id);E&&(E.status="done",E.result=w.result,E.duration_ms=w.duration_ms)}else if(I==="tool_error"){const E=D.toolCalls.find(y=>y.id===w.tool_call_id);E&&(E.status="error",E.result=w.error)}else if(I==="usage")D.tokenUsage=w.usage,a.lastTokenUsage.value=w.usage;else if(I==="truncated")o.value.has(F)&&c<e.maxAutoContinues&&(c++,e.maxAutoContinues,setTimeout(()=>{a.sendMessage("è¯·ç»§ç»­ä¸Šé¢æ²¡è¯´å®Œçš„å†…å®¹")},500));else if(I==="done"){c=0;const E=w.message_id||Date.now();(D.content||D.toolCalls.length)&&!a.messages.value.find(y=>y.id===E)&&a.messages.value.push({id:E,role:"assistant",sender_name:D.model,content:D.content||"",model_used:D.model,thinking_content:D.thinking||null,tool_calls:D.toolCalls.length?[...D.toolCalls]:null,token_usage:D.tokenUsage||null,created_at:new Date().toISOString()}),t.value.delete(F),o.value.delete(F),a.scrollToBottom(),a.refreshContextInfo()}else if(I==="error"){const E=w.error||"AI æœåŠ¡é”™è¯¯",y=Vn(E,w.error_meta);D.content?a.messages.value.push({id:Date.now(),role:"assistant",sender_name:D.model,content:D.content+`

---
`+jt(E,y),model_used:D.model,thinking_content:D.thinking||null,tool_calls:D.toolCalls.length?[...D.toolCalls]:null,created_at:new Date().toISOString()}):a.messages.value.push({id:Date.now(),role:"assistant",sender_name:D.model,content:jt(E,y),model_used:D.model,thinking_content:D.thinking||null,tool_calls:D.toolCalls.length?[...D.toolCalls]:null,created_at:new Date().toISOString()}),(y.max_context_tokens||y.rate_limit)&&e.updateModelCapability(D.model,y),t.value.delete(F),o.value.delete(F),a.scrollToBottom(),a.refreshContextInfo()}else I==="cancelled"&&(D.content&&a.messages.value.push({id:Date.now(),role:"assistant",sender_name:D.model,content:D.content+`

---
*â¹ å·²åœæ­¢*`,model_used:D.model,thinking_content:D.thinking||null,tool_calls:D.toolCalls.length?[...D.toolCalls]:null,created_at:new Date().toISOString()}),t.value.delete(F),o.value.delete(F),a.scrollToBottom())}function S(w){Yt.cancel(w).catch(()=>{});const I=t.value.get(w);I&&I.content&&a.messages.value.push({id:Date.now(),role:"assistant",sender_name:I.model,content:I.content+`

---
*â¹ å·²æ‰‹åŠ¨åœæ­¢*`,model_used:I.model,thinking_content:I.thinking||null,tool_calls:I.toolCalls.length?[...I.toolCalls]:null,created_at:new Date().toISOString()}),t.value.delete(w),o.value.delete(w),a.scrollToBottom()}return{streamingTasks:t,myTaskIds:o,anyStreamingWith:m,subscribe:T,unsubscribe:_,cancelTask:S}}function fl(a){const n=Ze(),e=ln(),t=Rt(),o=U(!1),s=U(""),l=U(""),c=U([]),m=U([]),T=U(!1),_=U(null),f=U(null),v=U(null),S=U(null),w=U("");let I=!1;function F(H){s.value+=H;const M=m.value,g=M[M.length-1];g&&g.type==="content"?g.text=(g.text||"")+H:M.push({type:"content",text:H})}async function D(H){var de;const M=(de=H.body)==null?void 0:de.getReader(),g=new TextDecoder;if(!M)throw new Error("No response body");let $="",N=[];I=!1;let R=!1;c.value=[],m.value=[];let ce=0;for(;;){const{done:ne,value:q}=await M.read();if(ne)break;const X=g.decode(q,{stream:!0}).split(`
`);for(const me of X)if(me.startsWith("data: ")){ce++;try{const Z=JSON.parse(me.slice(6));if(Z.type==="content")F(Z.content);else if(Z.type==="thinking")l.value+=Z.content,$+=Z.content;else if(Z.type==="context")a.persistentContextInfo.value=Z.context;else if(Z.type==="summary")w.value=Z.summary;else if(Z.type==="tool_call_start"){const Y=Z.tool_call||Z,ge={id:Y.id||"",name:Y.name||"",arguments:null,status:"preparing"};c.value.push(ge),m.value.push({type:"tool",toolCall:ge})}else if(Z.type==="tool_call"){const Y=Z.tool_call||Z,ge=Y.id||Z.tool_call_id||"",pe=c.value.find(ke=>ke.id===ge);if(pe)pe.arguments=Y.arguments||Z.arguments||"",pe.status="calling";else{const ke={id:ge,name:Y.name||Z.name||"",arguments:Y.arguments||Z.arguments||"",status:"calling"};c.value.push(ke),m.value.push({type:"tool",toolCall:ke})}}else if(Z.type==="tool_result"){const Y=c.value.find(ge=>ge.id===Z.tool_call_id);Y&&(Y.status="done",Y.result=Z.result,Y.duration_ms=Z.duration_ms),N=[...c.value]}else if(Z.type==="tool_error"){const Y=c.value.find(ge=>ge.id===Z.tool_call_id);Y&&(Y.status="error",Y.result=Z.error,Y.duration_ms=Z.duration_ms),N=[...c.value]}else if(Z.type==="truncated")R=!0;else if(Z.type==="usage")v.value=Z.usage,S.value=Z.usage;else if(!(Z.type==="heartbeat"||Z.type==="ask_user_pending")){if(Z.type==="cancelled")break;if(Z.type==="done")(s.value||N.length)&&(a.messages.value.push({id:Z.message_id||Date.now(),role:"assistant",sender_name:a.selectedModel.value,content:s.value||"",model_used:a.selectedModel.value,thinking_content:$||null,tool_calls:N.length?N:null,token_usage:v.value||null,created_at:new Date().toISOString()}),I=!0);else if(Z.type==="error"){const Y=Vn(Z.error,Z.error_meta);!s.value&&!I?(a.messages.value.push({id:Date.now(),role:"assistant",sender_name:a.selectedModel.value,content:jt(Z.error,Y),model_used:a.selectedModel.value,thinking_content:$||null,tool_calls:N.length?N:null,token_usage:v.value||null,created_at:new Date().toISOString()}),I=!0,(Y.max_context_tokens||Y.rate_limit)&&t.updateModelCapability(a.selectedModel.value,Y)):s.value&&!I&&(a.messages.value.push({id:Date.now(),role:"assistant",sender_name:a.selectedModel.value,content:s.value+`

---
`+jt(Z.error,Y),model_used:a.selectedModel.value,thinking_content:$||null,tool_calls:N.length?N:null,token_usage:v.value||null,created_at:new Date().toISOString()}),I=!0),n.warning(Y.summary||"âš ï¸ AI æœåŠ¡é”™è¯¯",{duration:1e4})}}}catch{}ce%5===0&&(await new Promise(Z=>setTimeout(Z,0)),a.scrollToBottom())}a.scrollToBottom()}return(s.value||N.length)&&!I&&a.messages.value.push({id:Date.now(),role:"assistant",sender_name:a.selectedModel.value,content:s.value||"",model_used:a.selectedModel.value,thinking_content:$||null,tool_calls:N.length?N:null,token_usage:v.value||null,created_at:new Date().toISOString()}),{truncated:R}}async function E(){var H;T.value=!0,o.value=!0,s.value="",l.value="",m.value=[],_.value=new AbortController;try{const M={"Content-Type":"application/json"};e.token&&(M.Authorization=`Bearer ${e.token}`);const $=(H=(await fetch(we.finalizePlanUrl(a.projectId()),{method:"POST",headers:M,signal:_.value.signal})).body)==null?void 0:H.getReader(),N=new TextDecoder;if(!$)throw new Error("No response body");for(;;){const{done:R,value:ce}=await $.read();if(R)break;const de=N.decode(ce,{stream:!0});for(const ne of de.split(`
`))if(ne.startsWith("data: "))try{const q=JSON.parse(ne.slice(6));q.type==="content"?(F(q.content),a.scrollToBottom()):q.type==="thinking"?(l.value+=q.content,a.scrollToBottom()):q.type==="done"?(n.success(`è®¾è®¡ç¨¿å·²ç”Ÿæˆ (v${q.plan_version})`),a.onPlanFinalized()):q.type==="error"&&n.error(q.error)}catch{}}s.value&&a.messages.value.push({id:Date.now(),role:"assistant",sender_name:`Plan Generator (${a.selectedModel.value})`,content:s.value,message_type:"plan_final",created_at:new Date().toISOString()})}catch(M){M.name!=="AbortError"&&n.error("Plan ç”Ÿæˆå¼‚å¸¸: "+(M.message||""))}finally{T.value=!1,o.value=!1,s.value="",l.value="",m.value=[],_.value=null,a.scrollToBottom()}}function y(){var H;(H=_.value)==null||H.abort(),f.value&&(Yt.cancel(f.value).catch(()=>{}),f.value=null),s.value&&a.messages.value.push({id:Date.now(),role:"assistant",sender_name:a.selectedModel.value,content:s.value+`

---
*â¹ å·²æ‰‹åŠ¨åœæ­¢*`,model_used:a.selectedModel.value,thinking_content:l.value||null,tool_calls:c.value.length?[...c.value]:null,created_at:new Date().toISOString()}),o.value=!1,s.value="",l.value="",c.value=[],m.value=[],_.value=null,a.scrollToBottom()}return{streaming:o,streamContent:s,streamThinking:l,streamToolCalls:c,streamSegments:m,finalizingPlan:T,lastTokenUsage:S,summaryNotice:w,appendStreamContent:F,handleSSEResponse:D,handleFinalizePlan:E,stopFinalizeStreaming:y}}function hl(a,n){const e=U({});function t(_){return e.value[_]||(e.value[_]={answers:{},customTexts:{},submitted:!1}),e.value[_]}function o(_,f,v,S){const w=t(_);if(w.answers[f]||(w.answers[f]=[]),S==="single")w.answers[f]=w.answers[f][0]===v?[]:[v];else{const I=w.answers[f].indexOf(v);I>=0?w.answers[f].splice(I,1):w.answers[f].push(v)}}function s(_,f){const v=t(_);v.submitted=!0;const S=[];f.forEach((I,F)=>{var y;const D=v.answers[F]||[],E=(y=v.customTexts[F])==null?void 0:y.trim();if(D.length||E){const H=E||D.join("ã€");S.push(`**${I.question}**
${H}`)}}),S.length===0&&S.push("ä»¥ä¸Šé—®é¢˜ç”±ä½ æ¥å†³å®šï¼Œè¯·ç»§ç»­ã€‚");const w=`<!-- ask_user_response -->
${S.join(`

`)}`;n(w)}function l(_,f){var S;const v=a.value.findIndex(w=>w.id===_.id);if(v<0)return!1;for(let w=v+1;w<a.value.length;w++){const I=a.value[w];if(I.role==="user"&&((S=I.content)!=null&&S.startsWith("<!-- ask_user_response -->")))return!0;if(I.role==="assistant")break}return!1}function c(_){var v;const f=a.value.findIndex(S=>S.id===_.id);if(f<0)return"";for(let S=f+1;S<a.value.length;S++){const w=a.value[S];if(w.role==="user"&&((v=w.content)!=null&&v.startsWith("<!-- ask_user_response -->")))return w.content.replace(`<!-- ask_user_response -->
`,"").replace("<!-- ask_user_response -->","");if(w.role==="assistant")break}return""}function m(_,f){const v=t(f.id);return v.submitted?Te(f.arguments).every((I,F)=>{var D,E;return!((D=v.answers[F])!=null&&D.length)&&!((E=v.customTexts[F])!=null&&E.trim())}):c(_).includes("ä»¥ä¸Šé—®é¢˜ç”±ä½ æ¥å†³å®š")}function T(_){return(_||[]).filter(f=>f.name!=="ask_user")}return{questionCardStates:e,getCardState:t,toggleOption:o,submitQuestionCard:s,isAskUserAnswered:l,getAskUserAnswer:c,isAskUserAutoDecided:m,getRegularToolCalls:T}}const ml={style:{display:"flex","flex-direction":"column",height:"100%","min-height":"400px"}},gl={class:"project-info-title"},_l={key:0,class:"project-info-sep"},yl={key:1,class:"project-info-desc"},vl={key:2,class:"project-info-desc",style:{opacity:"0.35"}},kl={style:{display:"flex","justify-content":"flex-end",gap:"8px"}},xl={style:{flex:"1",display:"flex",overflow:"hidden","min-height":"0"}},bl={key:0,class:"empty-chat-welcome"},wl={class:"empty-chat-icon"},Cl={class:"empty-chat-title"},zl={class:"empty-chat-desc"},Tl={key:0,style:{display:"flex","justify-content":"center"}},$l=["innerHTML"],Sl=["onMouseenter"],Il={class:"ask-user-reply-indicator"},Ml=["innerHTML"],jl=["onMouseenter"],Al={style:{"max-width":"85%",position:"relative"}},Rl={style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"4px"}},Ll=["innerHTML"],Pl={key:2,style:{"margin-bottom":"4px"}},Dl=["onClick"],El={class:"tool-group-count"},ql={key:0,class:"tool-group-body"},Bl={class:"tool-inline-name"},Ol={key:0,class:"tool-inline-args"},Ul={key:1,class:"tool-inline-time"},Nl=["innerHTML"],Hl=["innerHTML"],Fl={class:"question-card-header question-card-header-done"},Zl={class:"question-card-icon"},Wl={class:"question-card-title",style:{color:"#8a8a8a"}},Ql={class:"question-summary-q"},Vl={key:0,class:"question-summary-a"},Gl={key:1,class:"question-summary-a question-summary-a-auto"},Jl={key:1,class:"question-result-text"},Kl=["innerHTML"],Xl={class:"question-text"},Yl={key:0,class:"question-type-tag"},eo={key:0,class:"question-context"},to={key:1,class:"question-options"},no=["onClick"],so={key:0,class:"rec-dot"},lo={key:1,class:"option-desc"},oo=["placeholder","value","onInput"],ao={class:"question-submit-row"},io={key:3,style:{"margin-top":"4px","padding-top":"3px","border-top":"1px solid #333"}},ro={key:1,style:{display:"flex","justify-content":"center","margin-bottom":"6px"}},uo=["innerHTML"],co=["innerHTML"],po=["innerHTML"],fo={key:1,class:"question-card"},ho={class:"question-card-header"},mo={class:"question-card-header question-card-header-done"},go={class:"question-card-icon"},_o={class:"question-card-title",style:{color:"#8a8a8a"}},yo={class:"question-summary-q"},vo={key:0,class:"question-summary-a"},ko={key:1,class:"question-summary-a question-summary-a-auto"},xo={class:"question-card-header"},bo={key:1,class:"question-card-hint"},wo={class:"question-text"},Co={key:0,class:"question-type-tag"},zo={key:0,class:"question-context"},To={key:1,class:"question-options"},$o=["onClick"],So={key:0,class:"rec-dot"},Io={key:1,class:"option-desc"},Mo=["placeholder","value","onInput"],jo={key:0,class:"question-submit-row"},Ao={key:2,class:"tool-inline"},Ro={key:0,class:"tool-icon-pending"},Lo={key:1,class:"tool-icon-error"},Po={key:2,class:"tool-icon-ok"},Do={class:"tool-inline-name"},Eo={key:3,class:"tool-inline-args"},qo={key:4,class:"tool-inline-time"},Bo=["innerHTML"],Oo=["innerHTML"],Uo={key:0,style:{padding:"6px 8px",background:"#16213e","border-radius":"6px","margin-bottom":"4px"}},No={key:1,class:"input-area",style:{"justify-content":"center","align-items":"center","min-height":"48px",padding:"12px"}},Ho={key:2,class:"input-area"},Fo={class:"toolbar-row"},Zo={class:"model-select-group"},Wo=["disabled","title"],Qo={style:{padding:"4px 0"}},Vo={class:"action-bar"},Go={class:"action-bar-item",style:{cursor:"pointer"}},Jo={class:"action-bar-stat"},Ko={class:"ctx-breakdown"},Xo={class:"ctx-breakdown-bar"},Yo={class:"ctx-tree"},ea={class:"ctx-tree-node"},ta={class:"ctx-val"},na={key:0,class:"ctx-tree-children"},sa=["onClick"],la={key:1,class:"ctx-tree-arrow ctx-tree-leaf"},oa={class:"ctx-val"},aa={key:0,class:"ctx-tree-children"},ia=["onClick"],ra={class:"ctx-tree-label ctx-clickable"},ua={class:"ctx-val"},ca={class:"ctx-tree-node"},da={class:"ctx-tree-row"},pa={class:"ctx-val"},fa={class:"ctx-tree-node"},ha={class:"ctx-val"},ma={key:0,class:"ctx-tree-children"},ga={class:"ctx-msg-preview"},_a={class:"ctx-val"},ya={class:"ctx-tree-summary"},va={class:"ctx-val"},ka={key:0,class:"ctx-breakdown-msgs"},xa={key:0},ba={class:"ctx-content-pre"},Ln=rt({__name:"ChatPanel",props:{project:{},readonly:{type:Boolean}},emits:["plan-finalized"],setup(a,{emit:n}){var gn;const e=a,t=n,o=ln();Rt();const s=Ze();At();const l=U([]),c=U(""),m=U(!1),T=U(),_=U(),f=U(),v=U(null),S=U(!1),w=U(!1),I=Dn({}),{scrollToBottom:F,scrollToTop:D}=il(T),{selectedModel:E,loadingModels:y,sourceFilterOptions:H,sourceFilterLabel:M,modelOptions:g,currentModelCaps:$,selectedModelMaxTokens:N,currentModelToolRounds:R,onSourceFilterChange:ce,renderModelLabel:de,refreshModels:ne,loadModels:q}=cl(e.project.discussion_model||"gpt-4o"),{persistentContextInfo:P,contextCompressing:X,summarizing:me,ctxContentModal:Z,ctxContentTitle:Y,ctxContentText:ge,ctxExpanded:pe,displayContextInfo:ke,ctxBreakdown:Be,ctxMessages:Ce,ctxBreakdownPercents:Qe,ctxSystemSections:st,ctxHistoryDetail:Ve,refreshContextInfo:j,openCtxContent:z,handleSummarize:L,handleClearContext:J,handleModelChange:fe}=dl({projectId:()=>e.project.id,selectedModel:E,selectedModelMaxTokens:N,messages:l,scrollToBottom:F}),{streaming:Ie,streamThinking:He,streamToolCalls:Pt,streamSegments:Dt,finalizingPlan:Ge,lastTokenUsage:Et,summaryNotice:Le,handleFinalizePlan:Fe,stopFinalizeStreaming:Gn}=fl({projectId:()=>e.project.id,selectedModel:E,messages:l,persistentContextInfo:P,scrollToBottom:F,onPlanFinalized:()=>t("plan-finalized")}),{streamingTasks:qt,myTaskIds:Bt,anyStreamingWith:Jn,subscribe:Kn,unsubscribe:Xn,cancelTask:fn}=pl({projectId:()=>e.project.id,messages:l,persistentContextInfo:P,lastTokenUsage:Et,scrollToBottom:F,refreshContextInfo:j,sendMessage:V=>Je(V)}),hn=Jn(Ie),Yn=G(()=>{const V=[];for(const[r,le]of qt.value)V.push({key:"task-"+r,taskId:r,model:le.model||"æ¨¡åž‹",senderName:le.senderName||"",thinking:le.thinking,segments:le.segments,toolCalls:le.toolCalls,isMine:Bt.value.has(r)});return Ge.value&&Ie.value&&V.push({key:"finalize",taskId:0,model:E.value,senderName:"",thinking:He.value,segments:Dt.value,toolCalls:Pt.value,isMine:!0}),V}),{getCardState:ie,toggleOption:mn,submitQuestionCard:bt,isAskUserAnswered:es,getAskUserAnswer:ts,isAskUserAutoDecided:Ot,getRegularToolCalls:Ut}=hl(l,V=>Je(V)),lt=U(!1),ct=U(""),dt=U(""),Nt=U(!1);nn(lt,V=>{V&&(ct.value=e.project.title||"",dt.value=e.project.description||"")});async function ns(){var V,r;Nt.value=!0;try{await vt.update(e.project.id,{title:ct.value,description:dt.value}),e.project.title=ct.value,e.project.description=dt.value,lt.value=!1,s.success("é¡¹ç›®ä¿¡æ¯å·²æ›´æ–°")}catch(le){s.error(((r=(V=le==null?void 0:le.response)==null?void 0:V.data)==null?void 0:r.detail)||"ä¿å­˜å¤±è´¥")}finally{Nt.value=!1}}const Ht=U((gn=e.project.tool_permissions)!=null&&gn.length?e.project.tool_permissions:["ask_user"]);async function ss(V){try{await vt.update(e.project.id,{tool_permissions:V})}catch{s.error("ä¿å­˜å·¥å…·æƒé™å¤±è´¥")}}const We=U([]);async function ls(V){var _e,Me,je;const r=V.target,le=(_e=r.files)==null?void 0:_e[0];if(le){r.value="";try{const re=URL.createObjectURL(le),{data:oe}=await we.uploadImage(e.project.id,le);We.value.push({file:le,preview:re,uploaded:oe})}catch(re){s.error(((je=(Me=re.response)==null?void 0:Me.data)==null?void 0:je.detail)||"å›¾ç‰‡ä¸Šä¼ å¤±è´¥")}}}function os(V){I[V]=!I[V]}async function as(V){try{await navigator.clipboard.writeText(V.content),s.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{const r=document.createElement("textarea");r.value=V.content,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),s.success("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}}async function is(V){var _e,Me;const r=V.content,le=V.attachments||[];try{V.id&&V.id<1e12&&await we.deleteMessageAndAfter(e.project.id,V.id);const je=l.value.findIndex(re=>re.id===V.id);je>=0&&(l.value=l.value.slice(0,je)),await Je(r,le)}catch(je){s.error(((Me=(_e=je.response)==null?void 0:_e.data)==null?void 0:Me.detail)||"é‡è¯•å¤±è´¥")}}async function rs(V){try{V.id&&V.id<1e12&&await we.deleteMessage(e.project.id,V.id),l.value=l.value.filter(r=>r.id!==V.id),await Je("",[],!0)}catch(r){r.name!=="AbortError"&&s.error("é‡æ–°ç”Ÿæˆå¤±è´¥: "+(r.message||""))}}function us(){for(const V of Bt.value)fn(V);Ie.value&&Gn()}async function cs(){m.value=!0;try{await Je("",[],!0)}finally{m.value=!1}}async function Je(V,r,le=!1){var pt,Oe;const _e=V??c.value.trim(),Me=V!==void 0;if(!_e&&!We.value.length&&!Me)return;const je=Me?r||[]:We.value.filter(xe=>xe.uploaded).map(xe=>({type:"image",url:xe.uploaded.url,base64:xe.uploaded.base64,mime_type:xe.uploaded.mime_type,name:xe.file.name})),re=((pt=o.user)==null?void 0:pt.nickname)||((Oe=o.user)==null?void 0:Oe.username)||"user";Me||(c.value="",We.value=[]);const oe=Date.now();le||(l.value.push({id:oe,role:"user",sender_name:re,content:_e,attachments:je,created_at:new Date().toISOString()}),F());try{const xe={"Content-Type":"application/json"};o.token&&(xe.Authorization=`Bearer ${o.token}`);const Ae=await(await fetch(we.discussUrl(e.project.id),{method:"POST",headers:xe,body:JSON.stringify({message:_e,sender_name:re,attachments:je,max_tool_rounds:R.value,regenerate:le})})).json();if(Ae.status==="muted"){if(s.info("AI å·²ç¦è¨€ï¼Œæ¶ˆæ¯å·²ä¿å­˜"),Ae.user_message_id&&!le){const Pe=l.value.find(ot=>ot.id===oe);Pe&&(Pe.id=Ae.user_message_id)}return}if(Ae.task_id&&(Bt.value.add(Ae.task_id),Ae.user_message_id&&!le)){const Pe=l.value.find(ot=>ot.id===oe);Pe&&(Pe.id=Ae.user_message_id)}}catch(xe){xe.name!=="AbortError"&&s.error("AI é€šä¿¡å¼‚å¸¸: "+(xe.message||""))}}async function ds(){await Fe()}async function ps(){var V,r,le;w.value=!0;try{const{data:_e}=await we.toggleAiMute(e.project.id);S.value=_e.ai_muted,_e.ai_muted?s.warning("AI å·²ç¦è¨€ Â· ä»…äººå·¥è®¨è®ºæ¨¡å¼"):s.success("AI å·²è§£é™¤ç¦è¨€ Â· å‘é€æ¶ˆæ¯å°†è§¦å‘ AI å›žå¤")}catch(_e){((V=_e.response)==null?void 0:V.status)===401?s.error("Token å·²è¿‡æœŸï¼Œè¯·åˆ·æ–°é¡µé¢é‡æ–°ç™»å½•"):s.error(((le=(r=_e.response)==null?void 0:r.data)==null?void 0:le.detail)||"æ“ä½œå¤±è´¥")}finally{w.value=!1}}function fs(V){V.key==="Enter"&&!V.shiftKey&&!V.ctrlKey&&!V.metaKey&&(V.preventDefault(),Je())}return ut(async()=>{try{const{data:V}=await we.getMessages(e.project.id);l.value=V,D()}catch{}try{const{data:V}=await we.getAiMuteStatus(e.project.id);S.value=V.ai_muted}catch{}Kn(),q().then(()=>j()),setTimeout(()=>{P.value||j()},3e3)}),sn(()=>{Xn()}),(V,r)=>{var vn,kn;const le=B("n-ellipsis"),_e=B("n-input"),Me=B("n-form-item"),je=B("n-form"),re=B("n-text"),oe=B("n-button"),pt=B("n-modal"),Oe=B("n-space"),xe=B("n-collapse-item"),ft=B("n-collapse"),Ae=B("n-card"),Pe=B("n-popover"),ot=B("n-tag"),_n=B("n-button-group"),yn=B("n-image"),ht=B("n-spin"),hs=B("n-dropdown"),ms=B("n-select"),Ke=B("n-checkbox"),gs=B("n-checkbox-group"),_s=B("n-progress"),ys=B("n-scrollbar"),Ft=B("n-tooltip");return u(),x("div",ml,[h("div",{class:"project-info-bar",onClick:r[0]||(r[0]=b=>lt.value=!0)},[p(le,{"line-clamp":1,tooltip:!1,style:{flex:"1","min-width":"0"}},{default:i(()=>[h("span",gl,C(e.project.title),1),e.project.description?(u(),x("span",_l,"â€”")):A("",!0),e.project.description?(u(),x("span",yl,C(e.project.description),1)):(u(),x("span",vl,"ç‚¹å‡»æ·»åŠ éœ€æ±‚æè¿°..."))]),_:1}),r[16]||(r[16]=h("span",{class:"project-info-edit-icon"},"âœï¸",-1))]),p(pt,{show:lt.value,"onUpdate:show":r[4]||(r[4]=b=>lt.value=b),preset:"card",title:"ç¼–è¾‘é¡¹ç›®ä¿¡æ¯",style:{width:"520px","max-width":"90vw"},"mask-closable":!0},{footer:i(()=>[h("div",kl,[p(oe,{onClick:r[3]||(r[3]=b=>lt.value=!1)},{default:i(()=>[...r[18]||(r[18]=[k("å–æ¶ˆ",-1)])]),_:1}),p(oe,{type:"primary",onClick:ns,loading:Nt.value},{default:i(()=>[...r[19]||(r[19]=[k("ä¿å­˜",-1)])]),_:1},8,["loading"])])]),default:i(()=>[p(je,{"label-placement":"top","show-feedback":!1},{default:i(()=>[p(Me,{label:"é¡¹ç›®åç§°"},{default:i(()=>[p(_e,{value:ct.value,"onUpdate:value":r[1]||(r[1]=b=>ct.value=b),placeholder:"é¡¹ç›®åç§°"},null,8,["value"])]),_:1}),p(Me,{label:"éœ€æ±‚æè¿°",style:{"margin-top":"12px"}},{default:i(()=>[p(_e,{value:dt.value,"onUpdate:value":r[2]||(r[2]=b=>dt.value=b),type:"textarea",autosize:{minRows:3,maxRows:10},placeholder:"è¯¦ç»†æè¿°ä½ çš„éœ€æ±‚..."},null,8,["value"])]),_:1})]),_:1}),p(re,{depth:"3",style:{"font-size":"11px",display:"block","margin-top":"8px"}},{default:i(()=>[...r[17]||(r[17]=[k("éœ€æ±‚æè¿°ä¼šæ³¨å…¥åˆ°æ¯æ¬¡ AI å¯¹è¯çš„ä¸Šä¸‹æ–‡ä¸­",-1)])]),_:1})]),_:1},8,["show"]),h("div",xl,[h("div",{ref_key:"messageListRef",ref:T,style:{flex:"1","overflow-y":"auto",padding:"4px 0","min-width":"0"}},[!l.value.length&&!d(Ie)?(u(),x("div",bl,[h("div",wl,C(((vn=e.project.type_info)==null?void 0:vn.icon)||"ðŸ’¬"),1),h("div",Cl,C(((kn=e.project.type_info)==null?void 0:kn.name)||"è®¨è®º"),1),h("div",zl,C(e.project.title),1),p(oe,{type:"primary",size:"large",loading:m.value,disabled:S.value||e.readonly,style:{"margin-top":"20px","border-radius":"20px",padding:"0 32px"},onClick:cs},{icon:i(()=>[...r[20]||(r[20]=[h("span",{style:{"font-size":"16px"}},"âœ¨",-1)])]),default:i(()=>[r[21]||(r[21]=k(" å¼€å§‹å¯¹è¯ ",-1))]),_:1},8,["loading","disabled"]),e.readonly?(u(),Q(re,{key:0,depth:"3",style:{"font-size":"12px","margin-top":"8px"}},{default:i(()=>[...r[22]||(r[22]=[k("æ­¤é˜¶æ®µå·²å®Œæˆï¼Œå½“å‰ä¸ºåªè¯»æ¨¡å¼",-1)])]),_:1})):S.value?(u(),Q(re,{key:1,depth:"3",style:{"font-size":"12px","margin-top":"8px"}},{default:i(()=>[...r[23]||(r[23]=[k("AI å·²ç¦è¨€ï¼Œè¯·å…ˆè§£é™¤ç¦è¨€",-1)])]),_:1})):A("",!0)])):A("",!0),(u(!0),x(ae,null,he(l.value,b=>{var O;return u(),x("div",{key:b.id,style:{"margin-bottom":"6px"}},[b.role==="system"?(u(),x("div",Tl,[p(Ae,{size:"small",style:{"max-width":"90%",background:"#1a2a3e",border:"1px dashed #f0a020","border-radius":"6px","--n-padding-top":"4px","--n-padding-bottom":"4px"}},{default:i(()=>[p(ft,null,{default:i(()=>[p(xe,{name:"summary"},{header:i(()=>[p(Oe,{align:"center",size:4},{default:i(()=>[r[25]||(r[25]=h("span",{style:{"font-size":"14px"}},"ðŸ“",-1)),p(re,{style:{color:"#f0a020","font-size":"11px","font-weight":"500"}},{default:i(()=>[...r[24]||(r[24]=[k(" ä¸Šä¸‹æ–‡è‡ªåŠ¨æ€»ç»“ ",-1)])]),_:1}),p(re,{depth:"3",style:{"font-size":"10px"}},{default:i(()=>[k(C(d(Jt)(b.created_at)),1)]),_:2},1024)]),_:2},1024)]),default:i(()=>[h("div",{class:"thinking-block",innerHTML:d(qe)(b.content)},null,8,$l)]),_:2},1024)]),_:2},1024)]),_:2},1024)])):b.role==="user"&&((O=b.content)!=null&&O.startsWith("<!-- ask_user_response -->"))?(u(),x("div",{key:1,style:{display:"flex","justify-content":"flex-end"},onMouseenter:ye=>v.value=b.id,onMouseleave:r[5]||(r[5]=ye=>v.value=null)},[h("div",Il,[r[27]||(r[27]=h("span",{style:{opacity:"0.5"}},"ðŸ’¬",-1)),r[28]||(r[28]=h("span",null,"å·²æäº¤å›žç­”",-1)),p(Pe,{trigger:"click",placement:"bottom",style:{"max-width":"400px"}},{trigger:i(()=>[...r[26]||(r[26]=[h("span",{class:"ask-reply-detail-link"},"æŸ¥çœ‹",-1)])]),default:i(()=>[h("div",{class:"markdown-body",innerHTML:d(qe)(b.content.replace(`<!-- ask_user_response -->
`,""))},null,8,Ml)]),_:2},1024),p(re,{depth:"3",style:{"font-size":"10px","margin-left":"4px"}},{default:i(()=>[k(C(d(Jt)(b.created_at)),1)]),_:2},1024)])],40,Sl)):(u(),x("div",{key:2,style:at({display:"flex",justifyContent:b.role==="user"?"flex-end":"flex-start"}),onMouseenter:ye=>v.value=b.id,onMouseleave:r[6]||(r[6]=ye=>v.value=null)},[h("div",Al,[p(Ae,{size:"small",style:at({background:b.role==="user"?"#1a3a5c":"#1a2a3e",borderLeft:b.role==="assistant"?"2px solid #e94560":"none",borderRight:b.role==="user"?"2px solid #0ea5e9":"none","--n-padding-top":"6px","--n-padding-bottom":"6px","--n-padding-left":"10px","--n-padding-right":"10px"})},{header:i(()=>[h("div",Rl,[p(Oe,{align:"center",size:6,style:{flex:"1","min-width":"0"}},{default:i(()=>[p(re,{style:at({color:b.role==="assistant"?"#e94560":d(rl)(b.sender_name),fontSize:"12px"})},{default:i(()=>[k(C(b.sender_name||b.role),1)]),_:2},1032,["style"]),b.model_used?(u(),Q(ot,{key:0,size:"tiny",bordered:!1,round:""},{default:i(()=>[k(C(b.model_used),1)]),_:2},1024)):A("",!0),p(re,{depth:"3",style:{"font-size":"10px"}},{default:i(()=>[k(C(d(Jt)(b.created_at)),1)]),_:2},1024)]),_:2},1024),p(_n,{size:"tiny",class:Re(["msg-actions",{"msg-actions-visible":v.value===b.id}])},{default:i(()=>[p(oe,{quaternary:"",onClick:Cn(ye=>as(b),["stop"]),title:"å¤åˆ¶"},{icon:i(()=>[...r[29]||(r[29]=[h("span",{style:{"font-size":"11px"}},"ðŸ“‹",-1)])]),_:1},8,["onClick"]),p(oe,{quaternary:"",onClick:Cn(ye=>b.role==="user"?is(b):rs(b),["stop"]),title:b.role==="user"?"é‡æ–°å‘é€":"é‡æ–°ç”Ÿæˆ"},{icon:i(()=>[...r[30]||(r[30]=[h("span",{style:{"font-size":"11px"}},"ðŸ”„",-1)])]),_:1},8,["onClick","title"])]),_:2},1032,["class"])])]),default:i(()=>{var ye,Xe;return[(ye=b.attachments)!=null&&ye.length?(u(),Q(Oe,{key:0,style:{"margin-bottom":"6px"}},{default:i(()=>[(u(!0),x(ae,null,he(b.attachments.filter(W=>W.type==="image"),(W,K)=>(u(),Q(yn,{key:K,src:W.url,width:"180",style:{"border-radius":"6px"}},null,8,["src"]))),128))]),_:2},1024)):A("",!0),b.thinking_content?(u(),Q(ft,{key:1,style:{"margin-bottom":"6px"}},{default:i(()=>[p(xe,{title:"ðŸ’­ æ€è€ƒè¿‡ç¨‹",name:"thinking"},{default:i(()=>[h("div",{class:"thinking-block",innerHTML:d(qe)(b.thinking_content)},null,8,Ll)]),_:2},1024)]),_:2},1024)):A("",!0),d(Ut)(b.tool_calls).length?(u(),x("div",Pl,[h("div",{class:"tool-group-header",onClick:W=>os(b.id)},[h("span",{class:Re(["tool-group-arrow",{open:I[b.id]}])},"â–¶",2),r[31]||(r[31]=h("span",{class:"tool-group-icon"},"ðŸ› ï¸",-1)),h("span",El,C(d(Ut)(b.tool_calls).length)+" è½®å·¥å…·è°ƒç”¨",1)],8,Dl),I[b.id]?(u(),x("div",ql,[(u(!0),x(ae,null,he(d(Ut)(b.tool_calls),W=>{var K,te;return u(),x("div",{key:W.id,class:"tool-inline"},[h("span",{class:Re((K=W.result)!=null&&K.startsWith("ERROR:")?"tool-icon-error":"tool-icon-ok")},C((te=W.result)!=null&&te.startsWith("ERROR:")?"âŒ":"âœ…"),3),h("span",Bl,C(d(An)(W.name)),1),W.arguments?(u(),x("code",Ol,C(d(Rn)(W.name,W.arguments)),1)):A("",!0),W.duration_ms?(u(),x("span",Ul,"("+C(W.duration_ms)+"ms)",1)):A("",!0),p(Pe,{trigger:"click",placement:"bottom",style:{"max-width":"500px","max-height":"300px",overflow:"auto"}},{trigger:i(()=>[...r[32]||(r[32]=[h("span",{class:"tool-inline-view"},"æŸ¥çœ‹",-1)])]),default:i(()=>[h("div",{class:"tool-result-content",innerHTML:d(qe)(W.result||"(æ— ç»“æžœ)")},null,8,Nl)]),_:2},1024)])}),128))])):A("",!0)])):A("",!0),h("div",{class:"markdown-body",innerHTML:d(qe)(b.content)},null,8,Hl),(u(!0),x(ae,null,he((b.tool_calls||[]).filter(W=>W.name==="ask_user"&&d(Te)(W.arguments).length>0),W=>(u(),x("div",{key:W.id,class:"question-card",style:{"margin-top":"6px"}},[d(ie)(W.id).submitted||d(es)(b,W)?(u(),x(ae,{key:0},[h("div",Fl,[h("span",Zl,C(d(Ot)(b,W)?"ðŸ¤–":"âœ…"),1),h("span",Wl,C(d(Ot)(b,W)?"AI è‡ªè¡Œå†³å®š":"å·²å›žç­”"),1)]),d(ie)(W.id).submitted||d(Ot)(b,W)?(u(!0),x(ae,{key:0},he(d(Te)(W.arguments),(K,te)=>{var be,De,Ee,ve;return u(),x("div",{key:te,class:"question-summary-row"},[h("span",Ql,C(K.question),1),(be=d(ie)(W.id).answers[te])!=null&&be.length||(De=d(ie)(W.id).customTexts[te])!=null&&De.trim()?(u(),x("span",Vl,C(((Ee=d(ie)(W.id).customTexts[te])==null?void 0:Ee.trim())||((ve=d(ie)(W.id).answers[te])==null?void 0:ve.join("ã€"))),1)):d($t)(K)?(u(),x("span",Gl," ðŸ¤– "+C(d($t)(K)),1)):A("",!0)])}),128)):(u(),x("div",Jl,[h("div",{class:"markdown-body",innerHTML:d(qe)(d(ts)(b))},null,8,Kl)]))],64)):(u(),x(ae,{key:1},[r[35]||(r[35]=h("div",{class:"question-card-header"},[h("span",{class:"question-card-icon"},"ðŸ’¬"),h("span",{class:"question-card-title"},"AI æƒ³äº†è§£ä»¥ä¸‹é—®é¢˜"),h("span",{class:"question-card-hint"},"é€‰æ‹©åŽç‚¹å‡»æäº¤ï¼Œæœªå›žç­”çš„é—®é¢˜ç”± AI å†³å®š")],-1)),(u(!0),x(ae,null,he(d(Te)(W.arguments),(K,te)=>{var be,De,Ee,ve;return u(),x("div",{key:te,class:"question-item"},[h("div",Xl,[k(C(te+1)+". "+C(K.question)+" ",1),K.type==="multi"?(u(),x("span",Yl,"å¤šé€‰")):A("",!0)]),K.context?(u(),x("div",eo,C(K.context),1)):A("",!0),(be=K.options)!=null&&be.length?(u(),x("div",to,[(u(!0),x(ae,null,he(K.options,(ze,wt)=>{var mt,Zt;return u(),x("span",{key:wt,class:Re(["question-option-btn",{"question-option-selected":(mt=d(ie)(W.id).answers[te])==null?void 0:mt.includes(ze.label),"question-option-recommended":ze.recommended&&!((Zt=d(ie)(W.id).answers[te])!=null&&Zt.includes(ze.label))}]),onClick:si=>d(mn)(W.id,te,ze.label,K.type)},[ze.recommended?(u(),x("span",so)):A("",!0),k(" "+C(ze.label)+" ",1),ze.description?(u(),x("span",lo,C(ze.description),1)):A("",!0)],10,no)}),128))])):A("",!0),!((De=K.options)!=null&&De.length)||(Ee=d(ie)(W.id).answers[te])!=null&&Ee.some(ze=>ze.includes("å…¶ä»–"))?(u(),x("input",{key:2,class:"question-custom-input",placeholder:(ve=K.options)!=null&&ve.length?"è¯·è¡¥å……è¯´æ˜Ž...":"è¯·è¾“å…¥ä½ çš„å›žç­”...",value:d(ie)(W.id).customTexts[te]||"",onInput:ze=>d(ie)(W.id).customTexts[te]=ze.target.value},null,40,oo)):A("",!0)])}),128)),h("div",ao,[p(oe,{size:"small",type:"primary",onClick:K=>d(bt)(W.id,d(Te)(W.arguments))},{default:i(()=>[...r[33]||(r[33]=[k(" æäº¤å›žç­” ",-1)])]),_:1},8,["onClick"]),p(oe,{size:"tiny",quaternary:"",onClick:K=>d(bt)(W.id,d(Te)(W.arguments))},{default:i(()=>[...r[34]||(r[34]=[k(" è·³è¿‡å…¨éƒ¨ï¼ŒAI è‡ªè¡Œå†³å®š ",-1)])]),_:1},8,["onClick"])])],64))]))),128)),(Xe=b.token_usage)!=null&&Xe.tool_rounds?(u(),x("div",io,[p(re,{depth:"3",style:{"font-size":"10px",color:"#63e2b7"}},{default:i(()=>[k(" ðŸ› ï¸ "+C(b.token_usage.tool_rounds)+" è½®å·¥å…·è°ƒç”¨ ",1)]),_:2},1024)])):A("",!0)]}),_:2},1032,["style"])])],44,jl))])}),128)),d(Le)?(u(),x("div",ro,[p(Ae,{size:"small",style:{"max-width":"90%",background:"#1a2a3e",border:"1px dashed #f0a020","border-radius":"6px"}},{default:i(()=>[p(ft,null,{default:i(()=>[p(xe,{name:"summary"},{header:i(()=>[p(Oe,{align:"center",size:6},{default:i(()=>[r[37]||(r[37]=h("span",{style:{"font-size":"16px"}},"ðŸ“",-1)),p(re,{style:{color:"#f0a020","font-size":"12px","font-weight":"500"}},{default:i(()=>[...r[36]||(r[36]=[k(" ä¸Šä¸‹æ–‡å·²æŽ¥è¿‘ä¸Šé™ï¼Œè‡ªåŠ¨æ€»ç»“äº†æ—©æœŸå¯¹è¯ ",-1)])]),_:1})]),_:1})]),default:i(()=>[h("div",{class:"thinking-block",innerHTML:d(qe)(d(Le))},null,8,uo)]),_:1})]),_:1})]),_:1})])):A("",!0),(u(!0),x(ae,null,he(Yn.value,b=>(u(),x("div",{key:b.key,style:{display:"flex","justify-content":"flex-start","margin-bottom":"6px"}},[p(Ae,{size:"small",style:{"max-width":"85%",background:"#1a2a3e","border-left":"2px solid #e94560","--n-padding-top":"6px","--n-padding-bottom":"6px"}},{header:i(()=>[p(Oe,{align:"center",size:6},{default:i(()=>[p(re,{style:{color:"#e94560","font-size":"12px"}},{default:i(()=>[k(C(b.model),1)]),_:2},1024),b.senderName?(u(),Q(re,{key:0,depth:"3",style:{"font-size":"10px"}},{default:i(()=>[k("by "+C(b.senderName),1)]),_:2},1024)):A("",!0),p(ht,{size:"small"}),b.isMine&&b.taskId?(u(),Q(oe,{key:1,size:"tiny",type:"error",quaternary:"",onClick:O=>d(fn)(b.taskId),style:{padding:"0 4px","font-size":"11px"}},{default:i(()=>[...r[38]||(r[38]=[k("â¹",-1)])]),_:1},8,["onClick"])):A("",!0)]),_:2},1024)]),default:i(()=>[b.thinking?(u(),Q(ft,{key:0,"default-expanded-names":["thinking"],style:{"margin-bottom":"8px"}},{default:i(()=>[p(xe,{title:"ðŸ’­ æ€è€ƒè¿‡ç¨‹",name:"thinking"},{default:i(()=>[h("div",{class:"thinking-block",innerHTML:d(qe)(b.thinking)},null,8,co)]),_:2},1024)]),_:2},1024)):A("",!0),(u(!0),x(ae,null,he(b.segments,(O,ye)=>{var Xe;return u(),x(ae,{key:ye},[O.type==="content"?(u(),x("div",{key:0,class:"markdown-body",innerHTML:d(qe)((O.text||"")+(ye===b.segments.length-1?"â–":""))},null,8,po)):O.type==="tool"&&((Xe=O.toolCall)==null?void 0:Xe.name)==="ask_user"&&(O.toolCall.status==="preparing"||d(Te)(O.toolCall.arguments).length>0)?(u(),x("div",fo,[O.toolCall.status==="preparing"?(u(),x(ae,{key:0},[h("div",ho,[r[39]||(r[39]=h("span",{class:"question-card-icon"},"ðŸ’¬",-1)),r[40]||(r[40]=h("span",{class:"question-card-title"},"AI æ­£åœ¨ç»„ç»‡é—®é¢˜â€¦",-1)),p(ht,{size:12,style:{"margin-left":"6px"}})]),r[41]||(r[41]=h("div",{class:"question-preparing-body"},[h("div",{class:"question-preparing-skeleton"},[h("div",{class:"skeleton-line",style:{width:"70%"}}),h("div",{class:"skeleton-options"},[h("div",{class:"skeleton-pill"}),h("div",{class:"skeleton-pill",style:{width:"80px"}}),h("div",{class:"skeleton-pill",style:{width:"100px"}})]),h("div",{class:"skeleton-line",style:{width:"55%","margin-top":"10px"}}),h("div",{class:"skeleton-options"},[h("div",{class:"skeleton-pill",style:{width:"90px"}}),h("div",{class:"skeleton-pill",style:{width:"70px"}})])])],-1))],64)):d(ie)(O.toolCall.id).submitted?(u(),x(ae,{key:1},[h("div",mo,[h("span",go,C(d(Te)(O.toolCall.arguments).every((W,K)=>{var te,be;return!((te=d(ie)(O.toolCall.id).answers[K])!=null&&te.length)&&!((be=d(ie)(O.toolCall.id).customTexts[K])!=null&&be.trim())})?"ðŸ¤–":"âœ…"),1),h("span",_o,C(d(Te)(O.toolCall.arguments).every((W,K)=>{var te,be;return!((te=d(ie)(O.toolCall.id).answers[K])!=null&&te.length)&&!((be=d(ie)(O.toolCall.id).customTexts[K])!=null&&be.trim())})?"AI è‡ªè¡Œå†³å®š":"å·²å›žç­”"),1)]),(u(!0),x(ae,null,he(d(Te)(O.toolCall.arguments),(W,K)=>{var te,be,De,Ee;return u(),x("div",{key:K,class:"question-summary-row"},[h("span",yo,C(W.question),1),(te=d(ie)(O.toolCall.id).answers[K])!=null&&te.length||(be=d(ie)(O.toolCall.id).customTexts[K])!=null&&be.trim()?(u(),x("span",vo,C(((De=d(ie)(O.toolCall.id).customTexts[K])==null?void 0:De.trim())||((Ee=d(ie)(O.toolCall.id).answers[K])==null?void 0:Ee.join("ã€"))),1)):d($t)(W)?(u(),x("span",ko," ðŸ¤– "+C(d($t)(W)),1)):A("",!0)])}),128))],64)):(u(),x(ae,{key:2},[h("div",xo,[r[42]||(r[42]=h("span",{class:"question-card-icon"},"ðŸ’¬",-1)),r[43]||(r[43]=h("span",{class:"question-card-title"},"AI æƒ³äº†è§£ä»¥ä¸‹é—®é¢˜",-1)),O.toolCall.status==="calling"?(u(),Q(ht,{key:0,size:12,style:{"margin-left":"6px"}})):(u(),x("span",bo,"é€‰æ‹©åŽç‚¹å‡»æäº¤ï¼Œæœªå›žç­”çš„é—®é¢˜ç”± AI å†³å®š"))]),(u(!0),x(ae,null,he(d(Te)(O.toolCall.arguments),(W,K)=>{var te,be,De,Ee;return u(),x("div",{key:K,class:"question-item"},[h("div",wo,[k(C(K+1)+". "+C(W.question)+" ",1),W.type==="multi"?(u(),x("span",Co,"å¤šé€‰")):A("",!0)]),W.context?(u(),x("div",zo,C(W.context),1)):A("",!0),(te=W.options)!=null&&te.length?(u(),x("div",To,[(u(!0),x(ae,null,he(W.options,(ve,ze)=>{var wt,mt;return u(),x("span",{key:ze,class:Re(["question-option-btn",{"question-option-selected":(wt=d(ie)(O.toolCall.id).answers[K])==null?void 0:wt.includes(ve.label),"question-option-recommended":ve.recommended&&!((mt=d(ie)(O.toolCall.id).answers[K])!=null&&mt.includes(ve.label))}]),onClick:Zt=>d(mn)(O.toolCall.id,K,ve.label,W.type)},[ve.recommended?(u(),x("span",So)):A("",!0),k(" "+C(ve.label)+" ",1),ve.description?(u(),x("span",Io,C(ve.description),1)):A("",!0)],10,$o)}),128))])):A("",!0),!((be=W.options)!=null&&be.length)||(De=d(ie)(O.toolCall.id).answers[K])!=null&&De.some(ve=>ve.includes("å…¶ä»–"))?(u(),x("input",{key:2,class:"question-custom-input",placeholder:(Ee=W.options)!=null&&Ee.length?"è¯·è¡¥å……è¯´æ˜Ž...":"è¯·è¾“å…¥ä½ çš„å›žç­”...",value:d(ie)(O.toolCall.id).customTexts[K]||"",onInput:ve=>d(ie)(O.toolCall.id).customTexts[K]=ve.target.value},null,40,Mo)):A("",!0)])}),128)),O.toolCall.status!=="calling"?(u(),x("div",jo,[p(oe,{size:"small",type:"primary",onClick:W=>d(bt)(O.toolCall.id,d(Te)(O.toolCall.arguments))},{default:i(()=>[...r[44]||(r[44]=[k(" æäº¤å›žç­” ",-1)])]),_:1},8,["onClick"]),p(oe,{size:"tiny",quaternary:"",onClick:W=>d(bt)(O.toolCall.id,d(Te)(O.toolCall.arguments))},{default:i(()=>[...r[45]||(r[45]=[k(" è·³è¿‡å…¨éƒ¨ï¼ŒAI è‡ªè¡Œå†³å®š ",-1)])]),_:1},8,["onClick"])])):A("",!0)],64))])):O.type==="tool"&&O.toolCall?(u(),x("div",Ao,[O.toolCall.status==="calling"||O.toolCall.status==="preparing"?(u(),x("span",Ro,"â³")):O.toolCall.status==="error"?(u(),x("span",Lo,"âŒ")):(u(),x("span",Po,"âœ…")),h("span",Do,C(d(An)(O.toolCall.name)),1),O.toolCall.arguments?(u(),x("code",Eo,C(d(Rn)(O.toolCall.name,O.toolCall.arguments)),1)):A("",!0),O.toolCall.duration_ms?(u(),x("span",qo,"("+C(O.toolCall.duration_ms)+"ms)",1)):A("",!0),O.toolCall.status==="calling"||O.toolCall.status==="preparing"?(u(),Q(ht,{key:5,size:10,style:{"margin-left":"2px"}})):A("",!0),O.toolCall.result?(u(),Q(Pe,{key:6,trigger:"click",placement:"bottom",style:{"max-width":"500px","max-height":"300px",overflow:"auto"}},{trigger:i(()=>[...r[46]||(r[46]=[h("span",{class:"tool-inline-view"},"æŸ¥çœ‹",-1)])]),default:i(()=>[h("div",{class:"tool-result-content",innerHTML:d(qe)(O.toolCall.result)},null,8,Bo)]),_:2},1024)):A("",!0)])):A("",!0)],64)}),128)),b.segments.length?A("",!0):(u(),x("div",{key:1,class:"markdown-body",innerHTML:d(qe)("â–")},null,8,Oo))]),_:2},1024)]))),128))],512),bs(V.$slots,"aside")]),We.value.length?(u(),x("div",Uo,[p(Oe,{size:6},{default:i(()=>[(u(!0),x(ae,null,he(We.value,(b,O)=>(u(),x("div",{key:O,style:{position:"relative"}},[p(yn,{src:b.preview,width:"64",height:"64",style:{"border-radius":"6px","object-fit":"cover"}},null,8,["src"]),p(oe,{circle:"",size:"tiny",type:"error",style:{position:"absolute",top:"-4px",right:"-4px"},onClick:ye=>We.value.splice(O,1)},{default:i(()=>[...r[47]||(r[47]=[k("âœ•",-1)])]),_:1},8,["onClick"])]))),128))]),_:1})])):A("",!0),h("input",{ref_key:"fileInputRef",ref:f,type:"file",accept:"image/*",style:{display:"none"},onChange:ls},null,544),e.readonly?(u(),x("div",No,[p(re,{depth:"3",style:{"font-size":"13px"}},{default:i(()=>[...r[48]||(r[48]=[k("ðŸ”’ æ­¤é˜¶æ®µå·²å®Œæˆï¼Œå½“å‰ä¸ºåªè¯»æ¨¡å¼",-1)])]),_:1})])):(u(),x("div",Ho,[h("div",Fo,[p(hs,{options:d(H),onSelect:d(ce),trigger:"click",size:"small"},{default:i(()=>[p(oe,{size:"small",quaternary:"",style:{padding:"0 6px"}},{default:i(()=>[k(C(d(M))+" ",1),r[49]||(r[49]=h("span",{style:{"font-size":"10px","margin-left":"2px",opacity:"0.6"}},"â–¾",-1))]),_:1})]),_:1},8,["options","onSelect"]),h("div",Zo,[p(ms,{value:d(E),"onUpdate:value":[r[7]||(r[7]=b=>wn(E)?E.value=b:null),d(fe)],options:d(g),"render-label":d(de),size:"small",style:{width:"100%"},filterable:"","consistent-menu-width":!1},null,8,["value","options","render-label","onUpdate:value"]),h("button",{class:"model-refresh-btn",onClick:r[8]||(r[8]=(...b)=>d(ne)&&d(ne)(...b)),disabled:d(y),title:d(y)?"åˆ·æ–°ä¸­...":"åˆ·æ–°æ¨¡åž‹åˆ—è¡¨"},[h("span",{class:Re({"spin-icon":d(y)})},"âŸ²",2)],8,Wo)]),d($).supports_vision?(u(),Q(oe,{key:0,size:"small",quaternary:"",disabled:d(Ge),onClick:r[9]||(r[9]=b=>{var O;return(O=f.value)==null?void 0:O.click()})},{default:i(()=>[...r[50]||(r[50]=[k("ðŸ“· å›¾ç‰‡",-1)])]),_:1},8,["disabled"])):A("",!0),d($).supports_tools?(u(),Q(Pe,{key:1,trigger:"click",placement:"bottom",style:{"max-width":"320px"}},{trigger:i(()=>[p(oe,{size:"small",quaternary:"",type:Ht.value.length?"info":"default"},{default:i(()=>[...r[51]||(r[51]=[k("ðŸ› ï¸ å·¥å…·",-1)])]),_:1},8,["type"])]),default:i(()=>[h("div",Qo,[p(re,{strong:"",style:{"font-size":"13px"}},{default:i(()=>[...r[52]||(r[52]=[k("AI å·¥å…·æƒé™",-1)])]),_:1}),p(re,{depth:"3",style:{"font-size":"11px",display:"block",margin:"4px 0 8px"}},{default:i(()=>[...r[53]||(r[53]=[k(" å¼€å¯åŽ AI å¯æŸ¥çœ‹é¡¹ç›®æºç ï¼ˆå¯åœ¨è®¾ç½®é¡µé…ç½®å·¥å…·è½®æ¬¡ä¸Šé™ï¼‰ ",-1)])]),_:1}),p(gs,{value:Ht.value,"onUpdate:value":[r[10]||(r[10]=b=>Ht.value=b),ss]},{default:i(()=>[p(Oe,{vertical:"",size:4},{default:i(()=>[p(Ke,{value:"execute_readonly_command",label:"ðŸ–¥ï¸ æ‰§è¡Œåªè¯»å‘½ä»¤"}),p(Ke,{value:"execute_command",label:"âš ï¸ æ‰§è¡Œå†™å…¥å‘½ä»¤"},{default:i(()=>[r[55]||(r[55]=h("span",null,"âš ï¸ æ‰§è¡Œå†™å…¥å‘½ä»¤",-1)),p(re,{depth:"3",style:{"font-size":"10px","margin-left":"4px"}},{default:i(()=>[...r[54]||(r[54]=[k("(å±é™©)",-1)])]),_:1})]),_:1}),p(Ke,{value:"ask_user",label:"â“ ä¸»åŠ¨æé—®æ¾„æ¸…"}),p(Ke,{value:"read_source",label:"ðŸ“– è¯»å–æºç æ–‡ä»¶"}),p(Ke,{value:"read_config",label:"ðŸ“„ è¯»å–é…ç½®æ–‡ä»¶"}),p(Ke,{value:"search",label:"ðŸ” æœç´¢ä»£ç å†…å®¹"}),p(Ke,{value:"tree",label:"ðŸŒ³ æµè§ˆç›®å½•ç»“æž„"})]),_:1})]),_:1},8,["value"])])]),_:1})):A("",!0),d(qt).size>0&&!d(Ie)?(u(),Q(ot,{key:2,type:"warning",size:"small",bordered:!1,round:""},{default:i(()=>[k("â³ AI å›žå¤ä¸­ ("+C(d(qt).size)+")",1)]),_:1})):A("",!0)]),p(_e,{ref_key:"inputRef",ref:_,value:c.value,"onUpdate:value":r[11]||(r[11]=b=>c.value=b),type:"textarea",autosize:{minRows:1,maxRows:5},placeholder:S.value?"äººå·¥è®¨è®ºæ¨¡å¼ (Enter å‘é€)":"æè¿°ä½ çš„éœ€æ±‚... (Enter å‘é€, Shift+Enter æ¢è¡Œ)",disabled:d(Ge),onKeydown:fs,style:{margin:"4px 0"}},null,8,["value","placeholder","disabled"]),h("div",Vo,[p(Pe,{trigger:"click",placement:"top-start",style:{padding:"0"}},{trigger:i(()=>[h("div",Go,[p(_s,{type:"line",percentage:d(ke).percentage,"show-indicator":!1,height:3,style:{width:"48px"},color:d(ke).percentage>80?"#e94560":d(ke).percentage>50?"#f0a020":"#18a058"},null,8,["percentage","color"]),h("span",Jo,C(d($e)(d(ke).used))+"/"+C(d($e)(d(ke).total))+" Â· "+C(d(ke).percentage)+"% ",1),d(X)?(u(),Q(ht,{key:0,size:12,style:{"margin-left":"4px"}})):A("",!0)])]),default:i(()=>[h("div",Ko,[r[66]||(r[66]=h("div",{class:"ctx-breakdown-title"},"ðŸ“Š ä¸Šä¸‹æ–‡å ç”¨æ˜Žç»†",-1)),h("div",Xo,[h("div",{class:"ctx-bar-seg ctx-bar-system",style:at({width:d(Qe).system+"%"})},null,4),h("div",{class:"ctx-bar-seg ctx-bar-tools",style:at({width:d(Qe).tools+"%"})},null,4),h("div",{class:"ctx-bar-seg ctx-bar-history",style:at({width:d(Qe).history+"%"})},null,4)]),h("div",Yo,[h("div",ea,[h("div",{class:"ctx-tree-row",onClick:r[12]||(r[12]=b=>d(pe).system=!d(pe).system)},[h("span",{class:Re(["ctx-tree-arrow",{open:d(pe).system}])},"â–¶",2),r[56]||(r[56]=h("span",{class:"ctx-dot",style:{background:"#a855f7"}},null,-1)),r[57]||(r[57]=h("span",{class:"ctx-tree-label"},"System Prompt",-1)),h("span",ta,C(d($e)(d(Be).system)),1)]),d(pe).system&&d(st).length?(u(),x("div",na,[(u(!0),x(ae,null,he(d(st),(b,O)=>(u(),x("div",{key:O,class:"ctx-tree-node"},[h("div",{class:"ctx-tree-row ctx-tree-row-child",onClick:ye=>b.children?d(pe)["sys_"+O]=!d(pe)["sys_"+O]:d(z)(b.name,b.content)},[b.children?(u(),x("span",{key:0,class:Re(["ctx-tree-arrow",{open:d(pe)["sys_"+O]}])},"â–¶",2)):(u(),x("span",la,"Â·")),h("span",{class:Re(["ctx-tree-label",{"ctx-clickable":!b.children}])},C(b.name),3),h("span",oa,C(d($e)(b.tokens)),1)],8,sa),b.children&&d(pe)["sys_"+O]?(u(),x("div",aa,[(u(!0),x(ae,null,he(b.children,(ye,Xe)=>(u(),x("div",{key:Xe,class:"ctx-tree-row ctx-tree-row-leaf ctx-clickable-row",onClick:W=>d(z)(ye.name,ye.content)},[r[58]||(r[58]=h("span",{class:"ctx-tree-arrow ctx-tree-leaf"},"Â·",-1)),h("span",ra,C(ye.name),1),h("span",ua,C(d($e)(ye.tokens)),1)],8,ia))),128))])):A("",!0)]))),128))])):A("",!0)]),h("div",ca,[h("div",da,[r[59]||(r[59]=h("span",{class:"ctx-tree-arrow ctx-tree-leaf"},"Â·",-1)),r[60]||(r[60]=h("span",{class:"ctx-dot",style:{background:"#0ea5e9"}},null,-1)),r[61]||(r[61]=h("span",{class:"ctx-tree-label"},"å·¥å…·å®šä¹‰",-1)),h("span",pa,C(d($e)(d(Be).tools)),1)])]),h("div",fa,[h("div",{class:"ctx-tree-row",onClick:r[13]||(r[13]=b=>d(pe).history=!d(pe).history)},[h("span",{class:Re(["ctx-tree-arrow",{open:d(pe).history}])},"â–¶",2),r[62]||(r[62]=h("span",{class:"ctx-dot",style:{background:"#f59e0b"}},null,-1)),r[63]||(r[63]=h("span",{class:"ctx-tree-label"},"å¯¹è¯åŽ†å²",-1)),h("span",ha,C(d($e)(d(Be).history)),1)]),d(pe).history&&d(Ve).length?(u(),x("div",ma,[(u(!0),x(ae,null,he(d(Ve),(b,O)=>(u(),x("div",{key:O,class:"ctx-tree-row ctx-tree-row-leaf"},[r[64]||(r[64]=h("span",{class:"ctx-tree-arrow ctx-tree-leaf"},"Â·",-1)),h("span",{class:Re(["ctx-tree-label ctx-tree-msg-label","ctx-role-"+b.role])},[k(C(b.role==="user"?"ðŸ‘¤":b.role==="assistant"?"ðŸ¤–":"ðŸ“‹")+" ",1),h("span",ga,C(b.preview||"(ç©º)"),1)],2),h("span",_a,C(d($e)(b.tokens)),1)]))),128))])):A("",!0)])]),h("div",ya,[r[65]||(r[65]=h("span",null,"æ€»è®¡ / ä¸Šé™",-1)),h("span",va,C(d($e)(d(ke).used))+" / "+C(d($e)(d(ke).total)),1)]),d(Ce).total?(u(),x("div",ka,[k(" ðŸ’¬ æ¶ˆæ¯: ä¿ç•™ "+C(d(Ce).kept)+" / å…± "+C(d(Ce).total)+" ",1),d(Ce).dropped?(u(),x("span",xa," Â· ä¸¢å¼ƒ "+C(d(Ce).dropped),1)):A("",!0)])):A("",!0)])]),_:1}),p(pt,{show:d(Z),"onUpdate:show":r[14]||(r[14]=b=>wn(Z)?Z.value=b:null),preset:"card",title:d(Y),style:{width:"min(620px, 90vw)","max-height":"70vh"},bordered:!1,size:"small",segmented:{content:!0}},{default:i(()=>[p(ys,{style:{"max-height":"calc(70vh - 80px)"}},{default:i(()=>[h("pre",ba,C(d(ge)),1)]),_:1})]),_:1},8,["show","title"]),p(_n,{size:"tiny"},{default:i(()=>[p(Ft,{trigger:"hover"},{trigger:i(()=>[p(oe,{size:"tiny",quaternary:"",loading:d(me),disabled:d(Ie)||l.value.length<4,onClick:d(L)},{default:i(()=>[...r[67]||(r[67]=[k(" ðŸ“ ",-1)])]),_:1},8,["loading","disabled","onClick"])]),default:i(()=>[r[68]||(r[68]=k(" æ€»ç»“ä¸Šä¸‹æ–‡ï¼šå°†æ—§æ¶ˆæ¯åŽ‹ç¼©ä¸ºæ‘˜è¦ï¼Œé‡Šæ”¾ä¸Šä¸‹æ–‡ç©ºé—´ ",-1))]),_:1}),p(Ft,{trigger:"hover"},{trigger:i(()=>[p(oe,{size:"tiny",quaternary:"",disabled:d(Ie)||!l.value.length,onClick:d(J)},{default:i(()=>[...r[69]||(r[69]=[k(" ðŸ—‘ï¸ ",-1)])]),_:1},8,["disabled","onClick"])]),default:i(()=>[r[70]||(r[70]=k(" æ¸…ç©ºä¸Šä¸‹æ–‡ï¼šåˆ é™¤æ‰€æœ‰è®¨è®ºæ¶ˆæ¯ï¼Œé‡æ–°å¼€å§‹ ",-1))]),_:1})]),_:1}),r[73]||(r[73]=h("span",{class:"action-bar-spring"},null,-1)),p(Ft,{trigger:"hover"},{trigger:i(()=>[p(oe,{size:"small",type:S.value?"error":"default",quaternary:"",loading:w.value,onClick:ps},{default:i(()=>[k(C(S.value?"ðŸ”‡ AIå·²ç¦è¨€":"ðŸ”Š ç¦è¨€AI"),1)]),_:1},8,["type","loading"])]),default:i(()=>[k(" "+C(S.value?"è§£é™¤ç¦è¨€åŽï¼ŒAI ä¼šé˜…è¯»æ‰€æœ‰æ–°æ¶ˆæ¯å¹¶å›žå¤":"ç¦è¨€åŽä»…äººå·¥è®¨è®ºï¼ŒAI ä¸å‚ä¸Žå›žå¤"),1)]),_:1}),p(oe,{size:"small",type:"warning",quaternary:"",onClick:ds,loading:d(Ge),disabled:l.value.length<2||d(hn)},{default:i(()=>{var b,O;return[k(" ðŸ“‹ "+C(((O=(b=e.project.type_info)==null?void 0:b.ui_labels)==null?void 0:O.finalize_action)||"æ•²å®š"),1)]}),_:1},8,["loading","disabled"]),d(hn)?(u(),Q(oe,{key:0,size:"small",type:"error",onClick:us},{default:i(()=>[...r[71]||(r[71]=[k("â¹ åœæ­¢",-1)])]),_:1})):A("",!0),p(oe,{size:"small",type:"primary",onClick:r[15]||(r[15]=b=>Je()),disabled:d(Ge)||!c.value.trim()&&!We.value.length},{default:i(()=>[...r[72]||(r[72]=[k("å‘é€",-1)])]),_:1},8,["disabled"])])]))])}}}),wa={style:{display:"flex","flex-direction":"column",height:"100%"}},Ca={style:{flex:"1","overflow-y":"auto"}},za={key:1,style:{display:"flex",gap:"12px",height:"100%"}},Ta={style:{flex:"1","min-width":"0"}},$a={style:{flex:"1","min-width":"0","overflow-y":"auto",background:"#16213e","border-radius":"6px",padding:"12px"}},Sa=["innerHTML"],Ia=["innerHTML"],Pn=rt({__name:"PlanEditor",props:{project:{},outputNoun:{},finalizeAction:{}},emits:["updated"],setup(a,{emit:n}){const e=a,t=n,o=Ze(),s=U(!1),l=U(!1),c=U(""),m=U([]),T=U(null),_=U(""),f=G(()=>T.value!==null&&T.value!==e.project.plan_version),v=G(()=>f.value?_.value:e.project.plan_content),S=G(()=>{const g=v.value;if(!g)return"";try{return ee.parse(g,{async:!1})}catch{return g.replace(/\n/g,"<br>")}}),w=G(()=>{if(!c.value)return'<span style="color:#666">è¾“å…¥ Markdown å†…å®¹åŽè¿™é‡Œä¼šå®žæ—¶é¢„è§ˆ...</span>';try{return ee.parse(c.value,{async:!1})}catch{return c.value.replace(/\n/g,"<br>")}}),I=G(()=>m.value.map(g=>({label:`v${g.version}${g.is_current?" (å½“å‰)":""} - ${new Date(g.created_at).toLocaleDateString("zh-CN")}`,value:g.version})));function F(){s.value=!0,c.value=e.project.plan_content||""}function D(){T.value=e.project.plan_version||null,_.value=""}async function E(g){var $,N;if(g===e.project.plan_version){_.value="";return}try{const{data:R}=await we.getPlanVersion(e.project.id,g);_.value=R.content}catch(R){o.error("åŠ è½½ç‰ˆæœ¬å¤±è´¥: "+(((N=($=R.response)==null?void 0:$.data)==null?void 0:N.detail)||R.message))}}async function y(){var g,$;if(_.value){l.value=!0;try{await vt.update(e.project.id,{plan_content:_.value}),o.success(`å·²æ¢å¤åˆ° v${T.value}`),T.value=null,_.value="",t("updated")}catch(N){o.error((($=(g=N.response)==null?void 0:g.data)==null?void 0:$.detail)||"æ¢å¤å¤±è´¥")}finally{l.value=!1}}}async function H(){var g,$;l.value=!0;try{await vt.update(e.project.id,{plan_content:c.value}),o.success("è®¾è®¡ç¨¿å·²ä¿å­˜"),s.value=!1,t("updated")}catch(N){o.error((($=(g=N.response)==null?void 0:g.data)==null?void 0:$.detail)||"ä¿å­˜å¤±è´¥")}finally{l.value=!1}}async function M(){try{const{data:g}=await we.getPlanVersions(e.project.id);m.value=g,e.project.plan_version&&(T.value=e.project.plan_version)}catch{}}return ut(()=>M()),nn(()=>e.project.plan_version,()=>{M(),T.value=e.project.plan_version||null,_.value=""}),(g,$)=>{const N=B("n-text"),R=B("n-tag"),ce=B("n-select"),de=B("n-space"),ne=B("n-button"),q=B("n-empty"),P=B("n-card"),X=B("n-input");return u(),x("div",wa,[p(de,{justify:"space-between",align:"center",style:{"margin-bottom":"8px","flex-shrink":"0"}},{default:i(()=>[p(de,{align:"center",size:8},{default:i(()=>[p(N,{strong:""},{default:i(()=>[k(C(e.outputNoun||"è®¾è®¡ç¨¿"),1)]),_:1}),a.project.plan_version?(u(),Q(R,{key:0,size:"small",type:"info"},{default:i(()=>[k("v"+C(a.project.plan_version),1)]),_:1})):A("",!0),m.value.length>1?(u(),Q(ce,{key:1,value:T.value,"onUpdate:value":[$[0]||($[0]=me=>T.value=me),E],options:I.value,size:"small",style:{width:"140px"},placeholder:"ç‰ˆæœ¬åŽ†å²"},null,8,["value","options"])):A("",!0),f.value?(u(),Q(R,{key:2,size:"small",type:"warning"},{default:i(()=>[k(" æŸ¥çœ‹ v"+C(T.value)+" (åªè¯») ",1)]),_:1})):A("",!0)]),_:1}),p(de,{size:6},{default:i(()=>[f.value?(u(),Q(ne,{key:0,size:"small",onClick:D},{default:i(()=>[...$[3]||($[3]=[k(" â†© è¿”å›žå½“å‰ç‰ˆæœ¬ ",-1)])]),_:1})):A("",!0),f.value?(u(),Q(ne,{key:1,size:"small",type:"warning",onClick:y},{default:i(()=>[...$[4]||($[4]=[k(" ðŸ“¥ æ¢å¤æ­¤ç‰ˆæœ¬ ",-1)])]),_:1})):A("",!0),!f.value&&!s.value?(u(),Q(ne,{key:2,size:"small",onClick:F},{default:i(()=>[...$[5]||($[5]=[k(" âœï¸ ç¼–è¾‘ ",-1)])]),_:1})):A("",!0),s.value&&!f.value?(u(),Q(ne,{key:3,size:"small",onClick:$[1]||($[1]=me=>s.value=!1)},{default:i(()=>[...$[6]||($[6]=[k(" âœ– å–æ¶ˆ ",-1)])]),_:1})):A("",!0),s.value&&!f.value?(u(),Q(ne,{key:4,size:"small",type:"primary",onClick:H,loading:l.value},{default:i(()=>[...$[7]||($[7]=[k(" ðŸ’¾ ä¿å­˜ ",-1)])]),_:1},8,["loading"])):A("",!0)]),_:1})]),_:1}),h("div",Ca,[!v.value&&!s.value?(u(),Q(P,{key:0,style:{background:"#16213e"}},{default:i(()=>[p(q,{description:`è¿˜æ²¡æœ‰${e.outputNoun||"è®¾è®¡ç¨¿"}ï¼Œè¯·åœ¨è®¨è®ºåŒºå®Œæˆè®¨è®ºåŽç‚¹å‡»ã€Œ${e.finalizeAction||"æ•²å®šæ–¹æ¡ˆ"}ã€`},null,8,["description"])]),_:1})):s.value?(u(),x("div",za,[h("div",Ta,[p(X,{value:c.value,"onUpdate:value":$[2]||($[2]=me=>c.value=me),type:"textarea",autosize:{minRows:20,maxRows:60},placeholder:"Markdown æ ¼å¼çš„è®¾è®¡ç¨¿...",style:{"font-family":"'Fira Code', 'Cascadia Code', 'JetBrains Mono', monospace","font-size":"13px"}},null,8,["value"])]),h("div",$a,[p(N,{depth:"3",style:{"font-size":"11px",display:"block","margin-bottom":"8px"}},{default:i(()=>[...$[8]||($[8]=[k("ðŸ“– å®žæ—¶é¢„è§ˆ",-1)])]),_:1}),h("div",{class:"plan-markdown-body",innerHTML:w.value},null,8,Sa)])])):v.value?(u(),Q(P,{key:2,style:{background:"#16213e"}},{default:i(()=>[h("div",{class:"plan-markdown-body",innerHTML:S.value},null,8,Ia)]),_:1})):A("",!0)])])}}}),Ma={style:{background:"#0d1b2a",padding:"12px","border-radius":"8px","overflow-x":"auto","font-size":"12px","white-space":"pre-wrap"}},ja="macaulishchina/GoldenNest",Aa=rt({__name:"ImplementPanel",props:{project:{}},emits:["status-changed","go-review"],setup(a,{emit:n}){const e=a,t=n,o=Ze(),s=U(null),l=U("main"),c=U(""),m=U(!1),T=U(!1),_=U(!1),f=U(null);let v=null;const S=G(()=>{var q;return["implementing","reviewing"].includes(e.project.status)&&!!((q=s.value)!=null&&q.github_issue_number)}),w=G(()=>{var q;return((q=s.value)==null?void 0:q.status)==="agent_done"}),I=G(()=>{var P;const q=(P=s.value)==null?void 0:P.workflow_conclusion;return q==="success"?"Workflow æ‰§è¡ŒæˆåŠŸï¼ŒPR å·²å°±ç»ªã€‚å¯è¿›å…¥å®¡æŸ¥é˜¶æ®µã€‚":q==="failure"?"Workflow æ‰§è¡Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ Actions æ—¥å¿—åŽå†³å®šæ˜¯å¦ç»§ç»­å®¡æŸ¥ã€‚":"Copilot Agent ç¼–ç å·²å®Œæˆï¼Œå¯è¿›å…¥å®¡æŸ¥é˜¶æ®µã€‚"}),F=G(()=>{if(!s.value)return 0;const q=s.value.status;return q==="pr_merged"?5:q==="agent_done"||q==="pr_created"?3:q==="agent_working"?2:q==="task_created"?1:0}),D=G(()=>{var P;return{not_started:"default",task_created:"info",agent_working:"warning",agent_done:"success",pr_created:"success",pr_merged:"success"}[(P=s.value)==null?void 0:P.status]||"default"}),E=G(()=>{var P;return{not_started:"æœªå¼€å§‹",task_created:"ä»»åŠ¡å·²åˆ›å»º",agent_working:"Agent ç¼–ç ä¸­...",agent_done:"Agent ç¼–ç å®Œæˆ",pr_created:"PR å·²åˆ›å»º",pr_merged:"PR å·²åˆå¹¶"}[(P=s.value)==null?void 0:P.status]||""}),y=G(()=>{var P;const q=(P=s.value)==null?void 0:P.workflow_status;return q==="in_progress"?"Copilot Agent æ­£åœ¨ç¼–ç ...":q==="queued"?"æŽ’é˜Ÿç­‰å¾…æ‰§è¡Œ...":q==="completed"?"æ‰§è¡Œå®Œæˆ":"Copilot Coding Agent å¤„ç†ä¸­"}),H=G(()=>{var X,me;const q=(X=s.value)==null?void 0:X.workflow_status,P=(me=s.value)==null?void 0:me.workflow_conclusion;return q==="completed"&&P==="success"?"success":q==="completed"&&P==="failure"?"error":q==="completed"||q==="in_progress"?"warning":"default"}),M=G(()=>{var me,Z;const q=(me=s.value)==null?void 0:me.workflow_status,P=(Z=s.value)==null?void 0:Z.workflow_conclusion;return q==="completed"?{success:"âœ… æˆåŠŸ",failure:"âŒ å¤±è´¥",cancelled:"âšª å–æ¶ˆ"}[P]||`å®Œæˆ (${P})`:{in_progress:"ðŸ”„ è¿è¡Œä¸­",queued:"â³ æŽ’é˜Ÿä¸­"}[q]||q});function g(q){return F.value>q?"finish":F.value===q?"process":"wait"}async function $(){var q;T.value=!0;try{const{data:P}=await it.getStatus(e.project.id),X=(q=s.value)==null?void 0:q.status;s.value=P,P.status==="agent_done"&&X!=="agent_done"&&t("status-changed")}catch{}finally{T.value=!1}}async function N(){var q,P;m.value=!0;try{const{data:X}=await it.start(e.project.id,{custom_instructions:c.value,base_branch:l.value});o.success(X.message),t("status-changed"),de(),$()}catch(X){o.error(((P=(q=X.response)==null?void 0:q.data)==null?void 0:P.detail)||"å‘èµ·å®žæ–½å¤±è´¥")}finally{m.value=!1}}async function R(){var q,P;_.value=!0;try{const{data:X}=await it.getDiff(e.project.id);f.value=X}catch(X){o.error(((P=(q=X.response)==null?void 0:q.data)==null?void 0:P.detail)||"åŠ è½½ Diff å¤±è´¥")}finally{_.value=!1}}function ce(){t("go-review")}function de(){v||(v=setInterval(()=>{var P;const q=(P=s.value)==null?void 0:P.status;q==="agent_working"||q==="task_created"?$():ne()},15e3))}function ne(){v&&(clearInterval(v),v=null)}return ut(async()=>{var P;await $();const q=(P=s.value)==null?void 0:P.status;(q==="agent_working"||q==="task_created")&&de()}),sn(()=>ne()),(q,P)=>{var L;const X=B("n-input"),me=B("n-tooltip"),Z=B("n-button"),Y=B("n-space"),ge=B("n-card"),pe=B("n-step"),ke=B("n-steps"),Be=B("n-tag"),Ce=B("n-descriptions-item"),Qe=B("n-descriptions"),st=B("n-result"),Ve=B("n-text"),j=B("n-collapse-item"),z=B("n-collapse");return u(),x("div",null,[p(ge,{style:{background:"#16213e","margin-bottom":"16px"}},{default:i(()=>[p(Y,{vertical:"",size:12},{default:i(()=>[p(Y,{align:"center",size:12},{default:i(()=>[p(me,{trigger:"hover",placement:"bottom"},{trigger:i(()=>[p(X,{value:l.value,"onUpdate:value":P[0]||(P[0]=J=>l.value=J),size:"small",style:{width:"200px"},placeholder:"åŸºç¡€åˆ†æ”¯"},{prefix:i(()=>[...P[2]||(P[2]=[k("ðŸŒ¿",-1)])]),_:1},8,["value"])]),default:i(()=>[P[3]||(P[3]=h("div",{style:{"max-width":"280px","font-size":"12px"}},[h("b",null,"åŸºç¡€åˆ†æ”¯"),k(": Copilot Agent å°†åŸºäºŽæ­¤åˆ†æ”¯åˆ›å»º PRã€‚"),h("br"),k(" é€šå¸¸ä¸º "),h("code",null,"main"),k(" æˆ– "),h("code",null,"master"),k("ã€‚"),h("br"),k(" å¦‚éœ€åŸºäºŽå…¶ä»– feature åˆ†æ”¯å¼€å‘ï¼Œå¯åœ¨æ­¤ä¿®æ”¹ã€‚ ")],-1))]),_:1}),p(Z,{type:"primary",onClick:N,loading:m.value,disabled:!a.project.plan_content||S.value},{default:i(()=>[...P[4]||(P[4]=[k(" ðŸš€ å‘èµ·å®žæ–½ ",-1)])]),_:1},8,["loading","disabled"]),p(Z,{onClick:$,loading:T.value,size:"small"},{default:i(()=>[...P[5]||(P[5]=[k(" ðŸ”„ åˆ·æ–°çŠ¶æ€ ",-1)])]),_:1},8,["loading"])]),_:1}),p(X,{value:c.value,"onUpdate:value":P[1]||(P[1]=J=>c.value=J),type:"textarea",size:"small",placeholder:"é™„åŠ æŒ‡ä»¤ (å¯é€‰) â€” ç»™ Copilot Agent çš„é¢å¤–æç¤º",autosize:{minRows:2,maxRows:5}},null,8,["value"])]),_:1})]),_:1}),p(ge,{style:{background:"#16213e","margin-bottom":"16px"}},{default:i(()=>[p(ke,{current:F.value,size:"small"},{default:i(()=>[p(pe,{title:"åˆ›å»ºä»»åŠ¡",status:g(1),description:"åˆ›å»º Issue å¹¶åˆ†é… Agent"},null,8,["status"]),p(pe,{title:"Agent ç¼–ç ",status:g(2),description:y.value},null,8,["status","description"]),p(pe,{title:"ç¼–ç å®Œæˆ",status:g(3),description:"Workflow æ‰§è¡Œç»“æŸ"},null,8,["status"]),p(pe,{title:"è¿›å…¥å®¡æŸ¥",status:g(4),description:"AI å®¡æŸ¥å®žçŽ°è´¨é‡"},null,8,["status"])]),_:1},8,["current"])]),_:1}),s.value?(u(),Q(ge,{key:0,style:{background:"#16213e","margin-bottom":"16px"}},{default:i(()=>[p(Qe,{column:2,"label-placement":"left",bordered:"",size:"small"},{default:i(()=>[p(Ce,{label:"çŠ¶æ€"},{default:i(()=>[p(Be,{type:D.value,size:"small"},{default:i(()=>[k(C(E.value),1)]),_:1},8,["type"])]),_:1}),s.value.github_issue_number?(u(),Q(Ce,{key:0,label:"Issue"},{default:i(()=>[p(Z,{text:"",tag:"a",href:`https://github.com/${ja}/issues/${s.value.github_issue_number}`,target:"_blank"},{default:i(()=>[k(" #"+C(s.value.github_issue_number),1)]),_:1},8,["href"])]),_:1})):A("",!0),s.value.github_pr_number?(u(),Q(Ce,{key:1,label:"PR"},{default:i(()=>[p(Z,{text:"",tag:"a",href:s.value.pr_url,target:"_blank"},{default:i(()=>[k(" #"+C(s.value.github_pr_number)+" - "+C(s.value.pr_title),1)]),_:1},8,["href"])]),_:1})):A("",!0),s.value.branch_name?(u(),Q(Ce,{key:2,label:"åˆ†æ”¯"},{default:i(()=>[p(Be,{size:"small",bordered:!1},{default:i(()=>[k(C(s.value.branch_name),1)]),_:1})]),_:1})):A("",!0),s.value.workflow_status?(u(),Q(Ce,{key:3,label:"Workflow"},{default:i(()=>[p(Y,{align:"center",size:6},{default:i(()=>[p(Be,{type:H.value,size:"small"},{default:i(()=>[k(C(M.value),1)]),_:1},8,["type"]),s.value.workflow_url?(u(),Q(Z,{key:0,text:"",tag:"a",href:s.value.workflow_url,target:"_blank",size:"small"},{default:i(()=>[...P[6]||(P[6]=[k(" æŸ¥çœ‹ â†’ ",-1)])]),_:1},8,["href"])):A("",!0)]),_:1})]),_:1})):A("",!0),s.value.pr_files_changed?(u(),Q(Ce,{key:4,label:"å˜æ›´æ–‡ä»¶"},{default:i(()=>[k(C(s.value.pr_files_changed)+" ä¸ªæ–‡ä»¶ ",1)]),_:1})):A("",!0)]),_:1})]),_:1})):A("",!0),w.value?(u(),Q(ge,{key:1,style:{background:"#16213e","margin-bottom":"16px"}},{default:i(()=>[p(st,{status:"success",title:"Copilot Agent ç¼–ç å®Œæˆ",description:I.value},{footer:i(()=>[p(Y,null,{default:i(()=>{var J;return[p(Z,{type:"primary",onClick:ce},{default:i(()=>[...P[7]||(P[7]=[k(" ðŸ” è¿›å…¥å®¡æŸ¥ ",-1)])]),_:1}),(J=s.value)!=null&&J.github_pr_number?(u(),Q(Z,{key:0,onClick:R,loading:_.value,quaternary:""},{default:i(()=>[...P[8]||(P[8]=[k(" ðŸ“ æŸ¥çœ‹ Diff ",-1)])]),_:1},8,["loading"])):A("",!0)]}),_:1})]),_:1},8,["description"])]),_:1})):A("",!0),f.value?(u(),Q(ge,{key:2,title:"ðŸ“ PR Diff",style:{background:"#16213e","margin-bottom":"16px"}},{default:i(()=>[p(z,null,{default:i(()=>[(u(!0),x(ae,null,he(f.value.files,J=>(u(),Q(j,{key:J.filename,title:`${J.status==="added"?"ðŸŸ¢":J.status==="removed"?"ðŸ”´":"ðŸŸ¡"} ${J.filename}`,name:J.filename},{"header-extra":i(()=>[p(Ve,{depth:"3",style:{"font-size":"12px"}},{default:i(()=>[k(" +"+C(J.additions)+" -"+C(J.deletions),1)]),_:2},1024)]),default:i(()=>[h("pre",Ma,C(J.patch),1)]),_:2},1032,["title","name"]))),128))]),_:1})]),_:1})):A("",!0),((L=s.value)==null?void 0:L.status)==="pr_merged"?(u(),Q(Y,{key:3,style:{"margin-top":"16px"}},{default:i(()=>[p(Be,{type:"success",size:"large"},{default:i(()=>[...P[9]||(P[9]=[k("âœ… PR å·²åˆå¹¶",-1)])]),_:1})]),_:1})):A("",!0)])}}}),Ra=rt({__name:"DeployPanel",props:{project:{}},emits:["deployed"],setup(a,{emit:n}){const e=a,t=n,o=Ze(),s=At(),l=U([]),c=U(null),m=U(""),T=U(!1),_=U();let f=null;function v(){Xt(()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)})}async function S(M){const g=M?"ç›´æŽ¥åˆå¹¶å¹¶éƒ¨ç½²":"ç¡®è®¤åŽéƒ¨ç½²";s.warning({title:"ç¡®è®¤éƒ¨ç½²",content:`å³å°†${g}åˆ°ç”Ÿäº§çŽ¯å¢ƒã€‚éƒ¨ç½²å‰ä¼šè‡ªåŠ¨åˆ›å»ºå¿«ç…§ï¼Œå¤±è´¥ä¼šè‡ªåŠ¨å›žæ»šã€‚ç»§ç»­ï¼Ÿ`,positiveText:"å¼€å§‹éƒ¨ç½²",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{var $,N;T.value=!0,m.value=`ðŸš€ éƒ¨ç½²ä»»åŠ¡å·²æäº¤...
`;try{const{data:R}=await Qt.deploy(e.project.id,{skip_review:M});c.value=R,w(R.id)}catch(R){o.error(((N=($=R.response)==null?void 0:$.data)==null?void 0:N.detail)||"éƒ¨ç½²å¤±è´¥"),T.value=!1}}})}function w(M){const g=Qt.wsUrl(e.project.id,M);f=new WebSocket(g),f.onmessage=$=>{try{const N=JSON.parse($.data);N.type==="log"?(m.value+=N.message+`
`,v()):N.type==="history"?(m.value=N.logs,v()):N.type==="done"&&(T.value=!1,N.status==="healthy"?(o.success("âœ… éƒ¨ç½²æˆåŠŸ!"),t("deployed")):o.warning(`éƒ¨ç½²çŠ¶æ€: ${N.status}`),H())}catch{}},f.onerror=()=>{T.value=!1,o.error("WebSocket è¿žæŽ¥å¼‚å¸¸")},f.onclose=()=>{T.value=!1}}function I(M){return{pending:"default",building:"info",deploying:"warning",healthy:"success",failed:"error",rolled_back:"warning"}[M]||"default"}function F(M){return{pending:"ç­‰å¾…ä¸­",building:"æž„å»ºä¸­",deploying:"éƒ¨ç½²ä¸­",healthy:"å¥åº· âœ…",failed:"å¤±è´¥ âŒ",rolled_back:"å·²å›žæ»š ðŸ”„"}[M]||M}function D(M){return{merge_deploy:"Review & Deploy",direct_deploy:"Direct Deploy",preview:"åˆ†æ”¯é¢„è§ˆ",rollback:"å›žæ»š"}[M]||M}function E(M){return{healthy:"success",failed:"error",rolled_back:"warning",deploying:"info",building:"info"}[M]||"default"}function y(M){return new Date(M).toLocaleString("zh-CN")}async function H(){try{const{data:M}=await Qt.list(e.project.id);l.value=M}catch{}}return ut(()=>H()),sn(()=>{f&&f.close()}),(M,g)=>{const $=B("n-button"),N=B("n-space"),R=B("n-tag"),ce=B("n-card"),de=B("n-text"),ne=B("n-timeline-item"),q=B("n-timeline"),P=B("n-empty");return u(),x("div",null,[p(N,{style:{"margin-bottom":"16px"}},{default:i(()=>[p($,{type:"primary",onClick:g[0]||(g[0]=X=>S(!1)),loading:T.value},{default:i(()=>[...g[2]||(g[2]=[k(" ðŸš€ Review & Deploy ",-1)])]),_:1},8,["loading"]),p($,{type:"warning",onClick:g[1]||(g[1]=X=>S(!0)),loading:T.value},{default:i(()=>[...g[3]||(g[3]=[k(" âš¡ ç›´æŽ¥éƒ¨ç½² (è·³è¿‡ Review) ",-1)])]),_:1},8,["loading"])]),_:1}),c.value?(u(),Q(ce,{key:0,title:"ðŸ–¥ï¸ éƒ¨ç½²æ—¥å¿—",style:{background:"#0d1b2a","margin-bottom":"16px"}},{"header-extra":i(()=>[p(R,{type:I(c.value.status),size:"small"},{default:i(()=>[k(C(F(c.value.status)),1)]),_:1},8,["type"])]),default:i(()=>[h("div",{ref_key:"logRef",ref:_,style:{background:"#0a0a0a",color:"#00ff00","font-family":"'Courier New', monospace","font-size":"13px",padding:"16px","border-radius":"8px","max-height":"400px","overflow-y":"auto","white-space":"pre-wrap","line-height":"1.6"}},C(m.value),513)]),_:1})):A("",!0),p(ce,{title:"ðŸ“œ éƒ¨ç½²åŽ†å²",size:"small",style:{background:"#16213e"}},{default:i(()=>[l.value.length?(u(),Q(q,{key:0},{default:i(()=>[(u(!0),x(ae,null,he(l.value,X=>(u(),Q(ne,{key:X.id,type:E(X.status),title:D(X.deploy_type),content:X.error_message||"",time:y(X.started_at)},{header:i(()=>[p(N,{align:"center",size:8},{default:i(()=>[p(de,null,{default:i(()=>[k(C(D(X.deploy_type)),1)]),_:2},1024),p(R,{type:I(X.status),size:"small"},{default:i(()=>[k(C(F(X.status)),1)]),_:2},1032,["type"])]),_:2},1024)]),_:2},1032,["type","title","content","time"]))),128))]),_:1})):(u(),Q(P,{key:1,description:"æš‚æ— éƒ¨ç½²è®°å½•"}))]),_:1})])}}}),La=rt({__name:"SnapshotPanel",props:{projectId:{}},setup(a){const n=a,e=Ze(),t=At(),o=U([]),s=U(!1),l=U(!1),c=U(null);async function m(){s.value=!0;try{const{data:v}=await Vt.list({project_id:n.projectId});o.value=v}finally{s.value=!1}}async function T(){var v,S;l.value=!0;try{await Vt.create({description:`é¡¹ç›® #${n.projectId} æ‰‹åŠ¨å¿«ç…§`,project_id:n.projectId}),e.success("å¿«ç…§å·²åˆ›å»º"),m()}catch(w){e.error(((S=(v=w.response)==null?void 0:v.data)==null?void 0:S.detail)||"åˆ›å»ºå¤±è´¥")}finally{l.value=!1}}function _(v){t.warning({title:"ç¡®è®¤å›žæ»š",content:`å°†å›žæ»šåˆ° "${v.description||v.git_tag}"`,positiveText:"ç¡®å®š",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{var S,w;c.value=v.id;try{const{data:I}=await Vt.rollback(v.id);I.success?e.success("å›žæ»šæˆåŠŸ"):e.error(I.error||"å›žæ»šå¤±è´¥")}catch(I){e.error(((w=(S=I.response)==null?void 0:S.data)==null?void 0:w.detail)||"å›žæ»šå¤±è´¥")}finally{c.value=null}}})}function f(v){return new Date(v).toLocaleString("zh-CN")}return ut(()=>m()),(v,S)=>{const w=B("n-text"),I=B("n-button"),F=B("n-space"),D=B("n-timeline-item"),E=B("n-timeline"),y=B("n-empty"),H=B("n-spin");return u(),x("div",null,[p(F,{justify:"space-between",align:"center",style:{"margin-bottom":"12px"}},{default:i(()=>[p(w,{strong:""},{default:i(()=>[...S[0]||(S[0]=[k("é¡¹ç›®å…³è”å¿«ç…§",-1)])]),_:1}),p(I,{size:"small",type:"primary",onClick:T,loading:l.value},{default:i(()=>[...S[1]||(S[1]=[k(" ðŸ“¸ ä¸ºæ­¤é¡¹ç›®åˆ›å»ºå¿«ç…§ ",-1)])]),_:1},8,["loading"])]),_:1}),p(H,{show:s.value},{default:i(()=>[o.value.length?(u(),Q(E,{key:0},{default:i(()=>[(u(!0),x(ae,null,he(o.value,M=>(u(),Q(D,{key:M.id,type:M.is_healthy?"success":"error",title:M.description||M.git_tag,time:f(M.created_at)},{default:i(()=>[p(w,{depth:"3",style:{"font-size":"12px"}},{default:i(()=>[k(" Commit: "+C(M.git_commit.slice(0,8))+" Â· "+C(M.git_tag),1)]),_:2},1024)]),footer:i(()=>[p(I,{size:"tiny",onClick:g=>_(M),loading:c.value===M.id},{default:i(()=>[...S[2]||(S[2]=[k(" ðŸ”„ å›žæ»šåˆ°æ­¤ ",-1)])]),_:1},8,["onClick","loading"])]),_:2},1032,["type","title","time"]))),128))]),_:1})):(u(),Q(y,{key:1,description:"æ­¤é¡¹ç›®æš‚æ— å¿«ç…§"}))]),_:1},8,["show"])])}}}),Pa={key:0},Da={class:"project-header-bar"},Ea={class:"project-header-left"},qa={class:"project-header-steps"},Ba={class:"step-dot"},Oa={class:"step-text"},Ua={class:"project-header-right"},Na={key:0,class:"workspace-info-bar"},Ha={class:"discuss-layout"},Fa={class:"discuss-chat"},Za={key:0,class:"discuss-plan"},Wa={class:"plan-panel-header"},Qa={class:"plan-panel-body"},Va={key:0,style:{padding:"40px 0","text-align":"center"}},Ga={key:1},Ja={class:"workspace-info-bar"},Ka={class:"discuss-layout"},Xa={class:"discuss-chat"},Ya={key:0,class:"discuss-plan"},ei={class:"plan-panel-header"},ti={class:"plan-panel-body"},ni=rt({__name:"ProjectDetail",setup(a){const n=ws(),e=Cs(),t=Ze(),o=U("discuss"),s=U(!1),l=U(!1),c=U(!1),m=U(!1),T=U(!1),_=U({branch:"",diff_stat:"",changed_files:[],workspace_dir:""}),f=G(()=>e.currentProject),v=["è‰ç¨¿","è®¨è®º","å®šç¨¿","å®žæ–½","å®¡æ ¸","éƒ¨ç½²","å®Œæˆ"],S=["draft","discussing","planned","implementing","reviewing","deploying","deployed"],w=G(()=>{var j,z,L;return((L=(z=(j=f.value)==null?void 0:j.type_info)==null?void 0:z.ui_labels)==null?void 0:L.output_noun)||"è®¾è®¡ç¨¿"}),I=G(()=>{var j,z,L;return((L=(z=(j=f.value)==null?void 0:j.type_info)==null?void 0:z.ui_labels)==null?void 0:L.output_tab_label)||`ðŸ“‹ ${w.value}`}),F=G(()=>{var j,z,L;return((L=(z=(j=f.value)==null?void 0:j.type_info)==null?void 0:z.ui_labels)==null?void 0:L.finalize_action)||"æ•²å®šæ–¹æ¡ˆ"}),D=G(()=>{var j,z,L;return((L=(z=(j=f.value)==null?void 0:j.type_info)==null?void 0:z.ui_labels)==null?void 0:L.discuss_tab_label)||"ðŸ’¬ è®¨è®º & è®¾è®¡"}),E=G(()=>{var j,z,L;return((L=(z=(j=f.value)==null?void 0:j.type_info)==null?void 0:z.ui_labels)==null?void 0:L.review_discuss_tab_label)||"ðŸ’¬ å®¡æŸ¥/éªŒè¯"}),y=G(()=>{var j,z,L;return((L=(z=(j=f.value)==null?void 0:j.type_info)==null?void 0:z.ui_labels)==null?void 0:L.review_output_noun)||"å®¡æŸ¥æŠ¥å‘Š"}),H=G(()=>{var j,z,L;return((L=(z=(j=f.value)==null?void 0:j.type_info)==null?void 0:z.ui_labels)==null?void 0:L.review_finalize_action)||"ç”ŸæˆæŠ¥å‘Š"}),M=G(()=>{var z,L;const j=(L=(z=f.value)==null?void 0:z.type_info)==null?void 0:L.stages;return!j||j.length===0?!0:j.some(J=>J.status==="implementing")}),g=G(()=>{var z,L;const j=(L=(z=f.value)==null?void 0:z.type_info)==null?void 0:L.stages;return!j||j.length===0?!1:j.some(J=>J.status==="reviewing")}),$=G(()=>{var z,L;const j=(L=(z=f.value)==null?void 0:z.type_info)==null?void 0:L.stages;return!j||j.length===0?!0:j.some(J=>["deploying","deployed"].includes(J.status))}),N=G(()=>{var z,L;const j=(L=(z=f.value)==null?void 0:z.type_info)==null?void 0:L.stages;return j&&j.length>0?j.map(J=>J.label):v}),R=G(()=>{var z,L;const j=(L=(z=f.value)==null?void 0:z.type_info)==null?void 0:L.stages;return j&&j.length>0?j.map(J=>J.status):S}),ce=G(()=>{var J;const j=((J=f.value)==null?void 0:J.status)||"draft",z=R.value,L=z.indexOf(j);return L>=0?L+1:z.length}),de=G(()=>{var L,J,fe;const j=(J=(L=f.value)==null?void 0:L.type_info)==null?void 0:J.stages,z=(fe=f.value)==null?void 0:fe.status;return!j||j.length===0||!z?!1:j[j.length-1].status===z});function ne(j){var J,fe;const z=(fe=(J=f.value)==null?void 0:J.type_info)==null?void 0:fe.stages;return z&&z.length>0&&z[z.length-1].status===j?"success":{draft:"default",discussing:"info",planned:"warning",implementing:"warning",reviewing:"info",deploying:"warning",deployed:"success",rolled_back:"error"}[j]||"default"}function q(j){var J,fe;const z=(fe=(J=f.value)==null?void 0:J.type_info)==null?void 0:fe.stages;if(z){const Ie=z.find(He=>He.status===j);if(Ie)return Ie.label}return{draft:"è‰ç¨¿",discussing:"è®¨è®ºä¸­",planned:"å·²å®šç¨¿",implementing:"å®žæ–½ä¸­",reviewing:"å®¡æ ¸ä¸­",deploying:"éƒ¨ç½²ä¸­",deployed:"å·²éƒ¨ç½²",rolled_back:"å·²å›žæ»š"}[j]||j}async function P(){const j=Number(n.params.id);j&&await e.fetchProject(j)}const X={draft:"discuss",discussing:"discuss",planned:"discuss",implementing:"implement",reviewing:"review",deploying:"deploy",deployed:"deploy",rolled_back:"deploy"};function me(j){return X[j]||"discuss"}function Z(){if(!f.value)return;const j=me(f.value.status);j==="implement"&&!M.value||j==="review"&&!g.value||j==="deploy"&&!$.value||(o.value=j)}function Y(j){if(!f.value)return!1;const z=R.value,L=z.indexOf(f.value.status),J=z.indexOf(j);return L<0||J<0?!1:J<L}function ge(j){return!1}async function pe(){var j,z;if(f.value){m.value=!0;try{const L=await it.prepareReview(f.value.id);L.data.success?(c.value=!0,_.value={branch:L.data.branch||"",diff_stat:L.data.diff_stat||"",changed_files:L.data.changed_files||[],workspace_dir:L.data.workspace_dir||""},await P(),t.success("å®¡æŸ¥çŽ¯å¢ƒå‡†å¤‡å®Œæˆ")):t.error(L.data.message||"å®¡æŸ¥çŽ¯å¢ƒå‡†å¤‡å¤±è´¥")}catch(L){t.error(((z=(j=L==null?void 0:L.response)==null?void 0:j.data)==null?void 0:z.detail)||"å®¡æŸ¥çŽ¯å¢ƒå‡†å¤‡å¤±è´¥")}finally{m.value=!1}}}async function ke(){var j,z;if(f.value){T.value=!0;try{const L=await it.startIteration(f.value.id);L.data.success?(t.success(`å·²å¼€å§‹ç¬¬ ${L.data.iteration} æ¬¡è¿­ä»£`),c.value=!1,_.value={branch:"",diff_stat:"",changed_files:[],workspace_dir:""},await P(),Z()):t.error(L.data.message||"è¿­ä»£å¯åŠ¨å¤±è´¥")}catch(L){t.error(((z=(j=L==null?void 0:L.response)==null?void 0:j.data)==null?void 0:z.detail)||"è¿­ä»£å¯åŠ¨å¤±è´¥")}finally{T.value=!1}}}function Be(){P(),s.value=!0}function Ce(){P(),l.value=!0}function Qe(){o.value="review",P()}async function st(){if(!f.value)return;const j=!f.value.is_archived;try{await e.updateProject(f.value.id,{is_archived:j}),t.success(j?"å·²å½’æ¡£":"å·²å–æ¶ˆå½’æ¡£"),await P()}catch{t.error("æ“ä½œå¤±è´¥")}}async function Ve(){if(f.value&&(Z(),f.value.status==="reviewing"&&f.value.workspace_dir)){c.value=!0;try{const j=await it.getWorkspaceInfo(f.value.id);_.value={branch:j.data.branch||"",diff_stat:"",changed_files:[],workspace_dir:j.data.workspace_dir||""}}catch{}}}return ut(async()=>{await P(),Ve()}),nn(()=>n.params.id,async()=>{c.value=!1,_.value={branch:"",diff_stat:"",changed_files:[],workspace_dir:""},await P(),Ve()}),(j,z)=>{const L=B("n-button"),J=B("n-text"),fe=B("n-tag"),Ie=B("n-alert"),He=B("n-tab-pane"),Pt=B("n-space"),Dt=B("n-result"),Ge=B("n-tabs"),Et=B("n-spin");return f.value?(u(),x("div",Pa,[h("div",Da,[h("div",Ea,[p(L,{text:"",size:"small",onClick:z[0]||(z[0]=Le=>j.$router.push("/projects")),style:{padding:"0","font-size":"12px"}},{default:i(()=>[...z[6]||(z[6]=[k("â† è¿”å›ž",-1)])]),_:1}),p(J,{strong:"",style:{"font-size":"14px","white-space":"nowrap"}},{default:i(()=>[k(C(f.value.title),1)]),_:1}),p(fe,{type:ne(f.value.status),size:"tiny",round:""},{default:i(()=>[k(C(q(f.value.status)),1)]),_:1},8,["type"]),f.value.is_archived?(u(),Q(fe,{key:0,type:"default",size:"tiny",bordered:!1,round:""},{default:i(()=>[...z[7]||(z[7]=[k("å·²å½’æ¡£",-1)])]),_:1})):A("",!0)]),h("div",qa,[(u(!0),x(ae,null,he(N.value,(Le,Fe)=>(u(),x("div",{key:Fe,class:Re(["step-dot-item",{"step-done":Fe+1<ce.value||de.value&&Fe+1===ce.value,"step-current":Fe+1===ce.value&&!de.value}])},[h("span",Ba,C(Fe+1<ce.value||de.value&&Fe+1===ce.value?"âœ“":Fe+1),1),h("span",Oa,C(Le),1)],2))),128))]),h("div",Ua,[p(L,{size:"tiny",quaternary:!s.value,type:s.value?"info":"default",onClick:z[1]||(z[1]=Le=>s.value=!s.value),style:{"font-size":"11px"}},{default:i(()=>[k(C(I.value),1)]),_:1},8,["quaternary","type"]),g.value&&o.value==="review"?(u(),Q(L,{key:0,size:"tiny",quaternary:!l.value,type:l.value?"info":"default",onClick:z[2]||(z[2]=Le=>l.value=!l.value),style:{"font-size":"11px"}},{default:i(()=>[k(C(y.value),1)]),_:1},8,["quaternary","type"])):A("",!0),p(L,{size:"tiny",quaternary:"",type:f.value.is_archived?"warning":"default",onClick:st},{default:i(()=>[k(C(f.value.is_archived?"å–æ¶ˆå½’æ¡£":"å½’æ¡£é¡¹ç›®"),1)]),_:1},8,["type"]),f.value.github_issue_number?(u(),Q(fe,{key:1,size:"tiny",bordered:!1},{default:i(()=>[k("Issue #"+C(f.value.github_issue_number),1)]),_:1})):A("",!0),f.value.github_pr_number?(u(),Q(fe,{key:2,size:"tiny",bordered:!1,type:"info"},{default:i(()=>[k("PR #"+C(f.value.github_pr_number),1)]),_:1})):A("",!0)])]),p(Ge,{type:"line",animated:"",value:o.value,"onUpdate:value":z[5]||(z[5]=Le=>o.value=Le),size:"small",style:{"--n-tab-padding":"6px 12px"}},{default:i(()=>[p(He,{name:"discuss",tab:D.value,disabled:ge("discuss")},{default:i(()=>[f.value.workspace_dir&&f.value.iteration_count>0?(u(),x("div",Na,[p(fe,{size:"small",bordered:!1,type:"info"},{default:i(()=>[k(" ðŸ”„ è¿­ä»£ #"+C(f.value.iteration_count),1)]),_:1}),p(fe,{size:"small",bordered:!1},{default:i(()=>[k(" ðŸ“ "+C(f.value.workspace_dir),1)]),_:1})])):A("",!0),Y("discussing")?(u(),Q(Ie,{key:1,type:"info",style:{"margin-bottom":"8px"},bordered:!1},{default:i(()=>[...z[8]||(z[8]=[k(" è®¨è®ºé˜¶æ®µå·²å®Œæˆï¼Œå½“å‰ä¸ºåªè¯»æ¨¡å¼ã€‚å¦‚éœ€ä¿®æ”¹ï¼Œè¯·åœ¨å®¡æŸ¥é˜¶æ®µç‚¹å‡»ã€Œç»§ç»­è¿­ä»£ã€ã€‚ ",-1)])]),_:1})):A("",!0),h("div",Ha,[h("div",Fa,[p(Ln,{project:f.value,readonly:Y("discussing"),onPlanFinalized:Be},null,8,["project","readonly"])]),s.value?(u(),x("div",Za,[h("div",Wa,[p(L,{size:"tiny",quaternary:"",circle:"",onClick:z[3]||(z[3]=Le=>s.value=!1),style:{"flex-shrink":"0"}},{default:i(()=>[...z[9]||(z[9]=[k("âœ•",-1)])]),_:1})]),h("div",Qa,[p(Pn,{project:f.value,"output-noun":w.value,"finalize-action":F.value,onUpdated:P},null,8,["project","output-noun","finalize-action"])])])):A("",!0)])]),_:1},8,["tab","disabled"]),M.value?(u(),Q(He,{key:0,name:"implement",tab:"ðŸ”¨ å®žæ–½"},{default:i(()=>[p(Aa,{project:f.value,onStatusChanged:P,onGoReview:Qe},null,8,["project"])]),_:1})):A("",!0),g.value?(u(),Q(He,{key:1,name:"review",tab:E.value},{default:i(()=>[c.value?(u(),x("div",Ga,[h("div",Ja,[p(fe,{size:"small",bordered:!1,type:"success"},{default:i(()=>[...z[13]||(z[13]=[k("âœ… å®¡æŸ¥çŽ¯å¢ƒå°±ç»ª",-1)])]),_:1}),_.value.branch?(u(),Q(fe,{key:0,size:"small",bordered:!1},{default:i(()=>[k("ðŸŒ¿ "+C(_.value.branch),1)]),_:1})):A("",!0),_.value.diff_stat?(u(),Q(fe,{key:1,size:"small",bordered:!1},{default:i(()=>[k("ðŸ“Š "+C(_.value.diff_stat),1)]),_:1})):A("",!0),_.value.changed_files.length?(u(),Q(fe,{key:2,size:"small",bordered:!1},{default:i(()=>[k(" ðŸ“ "+C(_.value.changed_files.length)+" ä¸ªæ–‡ä»¶å˜æ›´ ",1)]),_:1})):A("",!0),f.value.status==="reviewing"?(u(),Q(L,{key:3,size:"tiny",quaternary:"",onClick:ke,loading:T.value},{default:i(()=>[...z[14]||(z[14]=[k(" ðŸ”„ ç»§ç»­è¿­ä»£ ",-1)])]),_:1},8,["loading"])):A("",!0)]),h("div",Ka,[h("div",Xa,[p(Ln,{project:f.value,onPlanFinalized:Ce},null,8,["project"])]),l.value?(u(),x("div",Ya,[h("div",ei,[p(L,{size:"tiny",quaternary:"",circle:"",onClick:z[4]||(z[4]=Le=>l.value=!1),style:{"flex-shrink":"0"}},{default:i(()=>[...z[15]||(z[15]=[k("âœ•",-1)])]),_:1})]),h("div",ti,[p(Pn,{project:f.value,"output-noun":y.value,"finalize-action":H.value,onUpdated:P},null,8,["project","output-noun","finalize-action"])])])):A("",!0)])])):(u(),x("div",Va,[p(Dt,{status:"info",title:"å‡†å¤‡å®¡æŸ¥çŽ¯å¢ƒ",description:"å…‹éš†å®žæ–½åˆ†æ”¯ã€èŽ·å–å˜æ›´ä¿¡æ¯ã€åŠ è½½éœ€æ±‚æ–‡æ¡£åˆ° AI ä¸Šä¸‹æ–‡"},{footer:i(()=>[p(Pt,{vertical:"",align:"center",size:16},{default:i(()=>[p(L,{type:"primary",size:"large",onClick:pe,loading:m.value},{default:i(()=>[...z[10]||(z[10]=[k(" ðŸ” å¼€å§‹å®¡æŸ¥ ",-1)])]),_:1},8,["loading"]),f.value.branch_name?(u(),Q(J,{key:0,depth:"3",style:{"font-size":"12px"}},{default:i(()=>[z[11]||(z[11]=k(" å°†åŸºäºŽåˆ†æ”¯ ",-1)),p(fe,{size:"small",bordered:!1},{default:i(()=>[k(C(f.value.branch_name),1)]),_:1}),z[12]||(z[12]=k(" åˆ›å»ºå®¡æŸ¥å·¥ä½œåŒº ",-1))]),_:1})):A("",!0)]),_:1})]),_:1})]))]),_:1},8,["tab"])):A("",!0),$.value?(u(),Q(He,{key:2,name:"deploy",tab:"ðŸš€ éƒ¨ç½²"},{default:i(()=>[p(Ra,{project:f.value,onDeployed:P},null,8,["project"])]),_:1})):A("",!0),p(He,{name:"snapshots",tab:"ðŸ“¸ å¿«ç…§"},{default:i(()=>[p(La,{"project-id":f.value.id},null,8,["project-id"])]),_:1})]),_:1},8,["value"])])):(u(),Q(Et,{key:1,show:!0,style:{"margin-top":"100px"}}))}}}),di=zs(ni,[["__scopeId","data-v-19014c92"]]);export{di as default};
