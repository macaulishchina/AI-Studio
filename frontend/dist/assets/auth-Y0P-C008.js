import{H as k,r as c,n as m}from"./index-okdrDDuw.js";import{j as l}from"./index-Bz-GYz9Z.js";const r="studio_user";function v(){try{const o=localStorage.getItem(r);return o?JSON.parse(o):null}catch{return null}}const _=k("studioAuth",()=>{const o=c(localStorage.getItem("studio_token")),a=c(v()),u=c(!1),g=m(()=>!!o.value),d=m(()=>{var t;return((t=a.value)==null?void 0:t.source)==="admin"});function s(t,e){o.value=t,a.value=e,localStorage.setItem("studio_token",t),localStorage.setItem(r,JSON.stringify(e))}function i(){o.value=null,a.value=null,localStorage.removeItem("studio_token"),localStorage.removeItem(r)}async function f(){if(o.value)try{const{data:e}=await l.me();return a.value=e,localStorage.setItem(r,JSON.stringify(e)),!0}catch{i()}const t=localStorage.getItem("token");if(t)try{const{data:e}=await l.verifyMainToken(t);return s(e.access_token,{username:e.username,nickname:e.nickname,source:e.source}),!0}catch{}return!1}async function S(t,e){u.value=!0;try{const{data:n}=await l.login(t,e);return s(n.access_token,{username:n.username,nickname:n.nickname,source:n.source}),!0}finally{u.value=!1}}return{token:o,user:a,loading:u,isLoggedIn:g,isAdmin:d,setToken:s,logout:i,autoAuth:f,adminLogin:S}});export{_ as useAuthStore};
