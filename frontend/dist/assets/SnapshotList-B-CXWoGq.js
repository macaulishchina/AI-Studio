import{s as y}from"./index-Bz-GYz9Z.js";import{d as D,x as L,A as T,o as V,c as h,b as l,w as a,r as u,e as o,g as r,h as d,j as _,F as j,v as A,i as F}from"./index-okdrDDuw.js";const q=D({__name:"SnapshotList",setup(M){const c=L(),C=T(),p=u([]),m=u(!1),f=u(!1),g=u(null);async function v(){m.value=!0;try{const{data:t}=await y.list();p.value=t}finally{m.value=!1}}async function b(){var t,e;f.value=!0;try{await y.create({description:`æ‰‹åŠ¨å¿«ç…§ ${new Date().toLocaleString("zh-CN")}`}),c.success("å¿«ç…§å·²åˆ›å»º"),v()}catch(s){c.error(((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.detail)||"åˆ›å»ºå¤±è´¥")}finally{f.value=!1}}function w(t){C.warning({title:"ç¡®è®¤å›æ»š",content:`å°†å›æ»šåˆ°å¿«ç…§ "${t.description||t.git_tag}"ï¼Œè¿™å°†é‡æ–°æ„å»ºå¹¶éƒ¨ç½²ä¸»é¡¹ç›®ã€‚ç¡®å®šç»§ç»­ï¼Ÿ`,positiveText:"ç¡®å®šå›æ»š",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{var e,s;g.value=t.id;try{const{data:i}=await y.rollback(t.id,{restore_db:!1});i.success?c.success("å›æ»šæˆåŠŸ"):c.error(i.error||"å›æ»šå¤±è´¥")}catch(i){c.error(((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.detail)||"å›æ»šå¤±è´¥")}finally{g.value=null}}})}function x(t){return new Date(t).toLocaleString("zh-CN")}return V(()=>v()),(t,e)=>{const s=o("n-h3"),i=o("n-button"),k=o("n-space"),$=o("n-tag"),N=o("n-timeline-item"),S=o("n-timeline"),z=o("n-empty"),B=o("n-spin");return r(),h("div",null,[l(k,{justify:"space-between",align:"center",style:{"margin-bottom":"16px"}},{default:a(()=>[l(s,{style:{margin:"0"}},{default:a(()=>[...e[0]||(e[0]=[d("ğŸ“¸ å¿«ç…§ç®¡ç†",-1)])]),_:1}),l(i,{type:"primary",onClick:b,loading:f.value},{default:a(()=>[...e[1]||(e[1]=[d(" æ‰‹åŠ¨åˆ›å»ºå¿«ç…§ ",-1)])]),_:1},8,["loading"])]),_:1}),l(B,{show:m.value},{default:a(()=>[p.value.length?(r(),_(S,{key:0},{default:a(()=>[(r(!0),h(j,null,A(p.value,n=>(r(),_(N,{key:n.id,type:n.is_healthy?"success":"error",title:`${n.description||n.git_tag}`,content:`Commit: ${n.git_commit.slice(0,8)} Â· Tag: ${n.git_tag}`,time:x(n.created_at)},{footer:a(()=>[l(k,null,{default:a(()=>[l(i,{size:"tiny",onClick:E=>w(n),loading:g.value===n.id},{default:a(()=>[...e[2]||(e[2]=[d(" ğŸ”„ å›æ»šåˆ°æ­¤ ",-1)])]),_:1},8,["onClick","loading"]),n.db_backup_path?(r(),_($,{key:0,size:"small",bordered:!1,type:"info"},{default:a(()=>[...e[3]||(e[3]=[d("æœ‰æ•°æ®åº“å¤‡ä»½",-1)])]),_:1})):F("",!0)]),_:2},1024)]),_:2},1032,["type","title","content","time"]))),128))]),_:1})):(r(),_(z,{key:1,description:"æš‚æ— å¿«ç…§"}))]),_:1},8,["show"])])}}});export{q as default};
